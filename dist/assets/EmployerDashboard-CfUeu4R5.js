import{r as d,j as e,O as ce,x as ae,al as re,aQ as ne,e as I,aR as ie,p as le,C as D,v as $e,a as $,_ as W,aS as ke,au as ge,aT as Ee,a0 as U,V as O,W as fe,as as oe,S as Le,q as Te,am as Fe,aw as P}from"./vendor-react-TQpn0NF6.js";import{A as y,b as R,u as Me}from"./index-BTp3XDAZ.js";import{M as K}from"./Modal-COfycESI.js";import{E as M}from"./endpoints-CXiMw_A_.js";import{m as ue}from"./messagingService-Qcq9CRin.js";import{m as ye}from"./vendor-motion-Qia1b_wX.js";import"./vendor-common-BZD0eUgH.js";import"./vendor-gsap-lnFyu4_T.js";const Ie=({isOpen:Q,onClose:c,selectedRequest:a,messages:f,newMessage:k,setNewMessage:n,sendMessage:b,messagingLoading:V,paymentHistory:u,loadingPaymentHistory:J,getStatusColor:B,getPriorityColor:S,getProgressColor:X,getProgressPercentage:j})=>{const[G,A]=d.useState(!1);if(!a)return null;const H=t=>{if(!t.candidate)return;const r=t.candidate,m=v(),l=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>${r.name} - Candidate Information</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
            .header { border-bottom: 2px solid #2563eb; padding-bottom: 10px; margin-bottom: 20px; }
            .header h1 { color: #2563eb; margin: 0; }
            .section { margin-bottom: 20px; }
            .section h2 { color: #374151; border-bottom: 1px solid #e5e7eb; padding-bottom: 5px; }
            .field { margin-bottom: 8px; }
            .field strong { color: #4b5563; }
            .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
            .sensitive { background-color: #f0f9ff; padding: 15px; border-left: 4px solid #10b981; margin-top: 20px; }
            .sensitive h3 { color: #065f46; margin-top: 0; }
            .footer { margin-top: 30px; padding-top: 15px; border-top: 1px solid #e5e7eb; font-size: 12px; color: #6b7280; }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>${r.name}</h1>
            <p>Candidate Information Report - Generated on ${new Date().toLocaleDateString()}</p>
          </div>
          
          <div class="section">
            <h2>Basic Information</h2>
            <div class="grid">
              <div class="field"><strong>Name:</strong> ${r.name}</div>
              <div class="field"><strong>Skills:</strong> ${r.skills||"Not specified"}</div>
              <div class="field"><strong>Experience:</strong> ${r.experience||"Not specified"}</div>
              <div class="field"><strong>Experience Level:</strong> ${r.experienceLevel||"Not specified"}</div>
              <div class="field"><strong>Education Level:</strong> ${r.educationLevel||"Not specified"}</div>
              <div class="field"><strong>Monthly Rate:</strong> ${r.monthlyRate||"Not specified"}</div>
              <div class="field"><strong>Location:</strong> ${typeof r.location=="object"?`${r.location.city||""}, ${r.location.country||""}`.replace(/^,\\s*|,\\s*$/g,""):r.location||"Not specified"}</div>
              <div class="field"><strong>Availability:</strong> ${r.availability||"Not specified"}</div>
              <div class="field"><strong>Languages:</strong> ${r.languages||"Not specified"}</div>
            </div>
          </div>

          ${r.description?`
            <div class="section">
              <h2>Description</h2>
              <p>${r.description}</p>
            </div>
          `:""}

          ${r.certifications?`
            <div class="section">
              <h2>Certifications</h2>
              <p>${r.certifications}</p>
            </div>
          `:""}

          ${m.canViewContact?`
            <div class="section">
              <h2>Contact Information</h2>
              <div class="field"><strong>Phone:</strong> ${r.contactNumber||"Not provided"}</div>
            </div>
          `:""}

          ${m.hasFullAccess||r.accessLevel==="full"?`
            <div class="sensitive">
              <h3>ðŸ”’ Sensitive Information (Full Access)</h3>
              <div class="grid">
                ${r.idNumber?`<div class="field"><strong>ID Number:</strong> ${r.idNumber}</div>`:""}
                ${r.dateOfBirth?`<div class="field"><strong>Date of Birth:</strong> ${new Date(r.dateOfBirth).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}</div>`:""}
                ${r.maritalStatus?`<div class="field"><strong>Marital Status:</strong> ${r.maritalStatus}</div>`:""}
                ${r.gender?`<div class="field"><strong>Gender:</strong> ${r.gender}</div>`:""}
              </div>
              ${r.references?`
                <div style="margin-top: 15px;">
                  <strong>References:</strong><br>
                  <p>${r.references}</p>
                </div>
              `:""}
            </div>
          `:""}

          <div class="footer">
            <p>This document contains confidential information. Please handle with care.</p>
            <p>Generated by Job Portal System - Request ID: ${t.id}</p>
          </div>
        </body>
      </html>
    `,x=window.open("","_blank");x.document.write(l),x.document.close(),x.onload=()=>{x.print(),setTimeout(()=>{x.close()},1e3)}},Z=(t,r)=>{if(!t)return"Unknown";console.log("ðŸ” Payment Status Debug:",{paymentType:t.paymentType,paymentStatus:t.status,requestStatus:r,paymentId:t.id});const m=(t.paymentType==="photo_access"||t.paymentType==="photo"||!t.paymentType&&["photo_access_granted","second_payment_required","second_payment_confirmed","full_access_granted","completed"].includes(r))&&["photo_access_granted","second_payment_required","second_payment_confirmed","full_access_granted","completed"].includes(r),l=(t.paymentType==="full_details"||t.paymentType==="full"||!t.paymentType&&["full_access_granted","completed"].includes(r))&&["full_access_granted","completed"].includes(r);if(console.log("ðŸ” Approval Check:",{isPhotoPaymentApproved:m,isFullPaymentApproved:l,finalResult:m||l?"Approved by Admin":"Not approved"}),m||l)return"Approved by Admin";switch(t.status){case"confirmed":return"Confirmed - Pending Admin Approval";case"approved":return"Approved by Admin";case"completed":return"Completed";case"pending":return"Pending Payment";case"rejected":return"Rejected";case"failed":return"Failed";default:return t.status?t.status.charAt(0).toUpperCase()+t.status.slice(1):"Unknown"}},Y=(t,r)=>{if(!t)return"bg-gray-100 text-gray-800";const m=(t.paymentType==="photo_access"||t.paymentType==="photo"||!t.paymentType&&["photo_access_granted","second_payment_required","second_payment_confirmed","full_access_granted","completed"].includes(r))&&["photo_access_granted","second_payment_required","second_payment_confirmed","full_access_granted","completed"].includes(r),l=(t.paymentType==="full_details"||t.paymentType==="full"||!t.paymentType&&["full_access_granted","completed"].includes(r))&&["full_access_granted","completed"].includes(r);if(m||l)return"bg-green-100 text-green-800";switch(t.status){case"confirmed":return"bg-blue-100 text-blue-800";case"approved":case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},E=()=>{const t=a.status;switch(console.log("ðŸŽ¯ Access Control Debug:",{requestStatus:t,selectedRequest:a}),t){case"pending":case"approved":case"first_payment_required":case"second_payment_required":return e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Payment Required"]});case"first_payment_confirmed":case"second_payment_confirmed":case"payment_confirmed":return e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Paid - Pending Approval"]});case"photo_access_granted":return e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Photo Access Approved"]});case"full_access_granted":case"completed":return e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Fully Paid & Approved"]});default:return e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Payment Required"]})}},N=()=>{switch(a.status){case"photo_access_granted":case"full_access_granted":case"completed":return"bg-green-100 text-green-800";case"first_payment_confirmed":case"second_payment_confirmed":case"payment_confirmed":return"bg-blue-100 text-blue-800";default:return"bg-orange-100 text-orange-800"}},v=()=>{const t=a.status,r=a.imageAccessGranted||a.candidate?.accessGranted?.photo,m=a.contactAccessGranted||a.candidate?.accessGranted?.contact,l=a.candidate?.accessGranted?.full||r&&m,x=["first_payment_confirmed","photo_access_granted","second_payment_confirmed","full_details_granted","payment_confirmed","completed"],g=["photo_access_granted","second_payment_confirmed","full_details_granted","completed"],L=x.includes(t),T=r||g.includes(t)||a.candidate?.accessLevel==="photo"||a.candidate?.accessLevel==="full";return{canViewPhoto:T,canViewContact:m||["full_details_granted","completed"].includes(t)||a.candidate?.accessLevel==="full",canDownloadPhoto:T&&L,hasFullAccess:l,isPaid:L,status:t}},w=async(t,r)=>{if(t)try{const l=await(await fetch(t)).blob(),x=window.URL.createObjectURL(l),g=document.createElement("a");g.href=x,g.download=`${r.replace(/\s+/g,"_")}_photo.jpg`,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(x)}catch(m){console.error("Error downloading image:",m),alert("Failed to download image. Please try again.")}},i=v();return e.jsxs(K,{isOpen:Q,onClose:c,title:`Request Details - #${a.id}`,maxWidth:"max-w-6xl",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ce,{className:"h-5 w-5 mr-2 text-blue-600"}),"Request Information"]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${B(a.status)}`,children:a.status?a.status.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase()):"Unknown"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Priority"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${S(a.priority)}`,children:a.priority?a.priority.charAt(0).toUpperCase()+a.priority.slice(1):"Unknown"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Created"}),e.jsx("p",{className:"text-gray-900",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Progress"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${X(j(a))}`,style:{width:`${j(a)}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[j(a),"%"]})]})]})]})})]}),a.candidate&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ae,{className:"h-5 w-5 mr-2 text-blue-600"}),"Candidate Information",e.jsxs("div",{className:"ml-auto flex items-center space-x-2",children:[(i.hasFullAccess||a.candidate?.accessLevel==="full")&&e.jsxs("button",{onClick:()=>H(a),className:"flex items-center px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors",title:"Download Full Candidate Information as PDF",children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Download PDF"]}),i.hasFullAccess&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),"Full Access"]}),i.canViewPhoto&&!i.hasFullAccess&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Photo Access"]}),!i.canViewPhoto&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"No Access"]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4 pb-4 border-b border-gray-200",children:[i.canViewPhoto?a.candidate.photo?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:(()=>{const t=a.candidate.photo;if(!t)return"/api/placeholder/64/64";if(t.startsWith("http"))return t;const r=t.replace(/^\/+/,"");return`${y.BASE_URL}/${r}`})(),alt:a.candidate.name,className:"w-16 h-16 rounded-full object-cover border-2 border-gray-200 cursor-pointer hover:ring-2 hover:ring-blue-300 transition-all",onError:t=>{t.target.src="/api/placeholder/64/64"},onClick:()=>A(!0)}),i.canDownloadPhoto&&e.jsx("button",{onClick:()=>{const t=a.candidate.photo,r=t.startsWith("http")?t:`${y.BASE_URL}/${t.replace(/^\/+/,"")}`;w(r,a.candidate.name)},className:"absolute -top-1 -right-1 p-1 bg-blue-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-blue-700",title:"Download Image",children:e.jsx(re,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center border-2 border-gray-300 relative",children:[e.jsx(ae,{className:"h-8 w-8 text-gray-500"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 p-1 bg-green-500 text-white rounded-full",children:e.jsx(I,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"w-16 h-16 rounded-full bg-gray-300 flex items-center justify-center relative",children:[e.jsx(le,{className:"h-6 w-6 text-gray-500"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 p-1 bg-red-500 text-white rounded-full",children:e.jsx(ie,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"text-lg font-semibold text-gray-900",children:a.candidate.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.candidate.skills}),e.jsx("p",{className:"text-sm font-medium text-green-600",children:a.candidate.monthlyRate}),!i.canViewPhoto&&e.jsxs("div",{className:"mt-2 flex items-center text-xs text-orange-600",children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Photo access requires payment approval"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Experience"}),e.jsx("p",{className:"text-gray-900",children:a.candidate.experience})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Location"}),e.jsx("p",{className:"text-gray-900",children:typeof a.candidate.location=="object"?`${a.candidate.location.city||""}, ${a.candidate.location.country||""}`.replace(/^,\s*|,\s*$/g,""):a.candidate.location||"Not specified"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-500 flex items-center",children:["Contact",!i.canViewContact&&e.jsx(le,{className:"h-3 w-3 ml-1 text-red-500"})]}),e.jsx("p",{className:"text-gray-900",children:i.canViewContact?a.candidate.contactNumber||"Not provided":"***-***-***"}),!i.canViewContact&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Requires full details access"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-500 flex items-center",children:["Email",!i.canViewContact&&e.jsx(le,{className:"h-3 w-3 ml-1 text-red-500"})]}),e.jsx("p",{className:"text-gray-900",children:i.canViewContact?a.candidate.email||"Not provided":"***@***.***"}),!i.canViewContact&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Requires full details access"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Education Level"}),e.jsx("p",{className:"text-gray-900",children:a.candidate.educationLevel})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Experience Level"}),e.jsx("p",{className:"text-gray-900",children:a.candidate.experienceLevel})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Availability"}),e.jsx("p",{className:"text-gray-900",children:a.candidate.availability})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Languages"}),e.jsx("p",{className:"text-gray-900",children:a.candidate.languages})]})]}),a.candidate.description&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-900 text-sm leading-relaxed",children:a.candidate.description})]}),a.candidate.certifications&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-2",children:"Certifications"}),e.jsx("p",{className:"text-gray-900 text-sm",children:a.candidate.certifications})]}),i.canViewContact&&(i.hasFullAccess||a.candidate?.accessLevel==="full")&&e.jsxs("div",{className:"mt-6 pt-4 border-t-2 border-green-200 bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(ne,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("h6",{className:"text-sm font-semibold text-green-900",children:"Full Access Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.candidate.idNumber&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ID Number"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm",children:a.candidate.idNumber})]}),a.candidate.dateOfBirth&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Date of Birth"}),e.jsx("p",{className:"text-gray-900 text-sm",children:new Date(a.candidate.dateOfBirth).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),a.candidate.maritalStatus&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Marital Status"}),e.jsx("p",{className:"text-gray-900 text-sm capitalize",children:a.candidate.maritalStatus})]}),a.candidate.gender&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Gender"}),e.jsx("p",{className:"text-gray-900 text-sm capitalize",children:a.candidate.gender})]})]}),a.candidate.references&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-green-300",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-2",children:"References"}),e.jsx("p",{className:"text-gray-900 text-sm leading-relaxed",children:a.candidate.references})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Access Control & Status"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Photo Access"})]}),e.jsxs("div",{className:"flex items-center",children:[i.canViewPhoto?e.jsx($,{className:"h-4 w-4 text-green-500 mr-1"}):e.jsx(W,{className:"h-4 w-4 text-orange-500 mr-1"}),e.jsx("span",{className:`text-xs font-medium ${i.canViewPhoto?"text-green-600":"text-orange-600"}`,children:i.canViewPhoto?"Granted":"Pending"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"h-4 w-4 mr-2 text-purple-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Contact Access"})]}),e.jsxs("div",{className:"flex items-center",children:[i.canViewContact?e.jsx($,{className:"h-4 w-4 text-green-500 mr-1"}):e.jsx(W,{className:"h-4 w-4 text-orange-500 mr-1"}),e.jsx("span",{className:`text-xs font-medium ${i.canViewContact?"text-green-600":"text-orange-600"}`,children:i.canViewContact?"Granted":"Pending"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(ke,{className:"h-4 w-4 mr-2 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Current Access Level"})]}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${i.hasFullAccess?"bg-green-100 text-green-800":i.canViewPhoto?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:i.hasFullAccess?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),"Full Access"]}):i.canViewPhoto?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Photo Only"]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"No Access"]})})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(ge,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Payment Status"})]}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${N()}`,children:E()})]})]})]}),!i.canViewPhoto&&e.jsx("div",{className:"mt-4 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(D,{className:"h-5 w-5 text-orange-500 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-sm font-medium text-orange-800",children:"Photo Access Required"}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"Complete the first payment to unlock candidate photo and basic information."})]})]})}),i.canViewPhoto&&!i.canViewContact&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(D,{className:"h-5 w-5 text-blue-500 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-sm font-medium text-blue-800",children:"Full Details Access Available"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Complete the second payment to unlock contact information and full candidate details."})]})]})}),i.hasFullAccess&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx($,{className:"h-5 w-5 text-green-500 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-sm font-medium text-green-800",children:"Full Access Granted"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"You have complete access to all candidate information including contact details."})]})]})})]})]})]}),a.paymentRequired&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Ee,{className:"h-5 w-5 mr-2 text-blue-600"}),"Payment History"]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Amount Required"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:[a.paymentAmount," ",a.paymentCurrency]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Due Date"}),e.jsx("p",{className:"text-gray-900",children:a.paymentDueDate?new Date(a.paymentDueDate).toLocaleDateString():"Not specified"})]}),a.paymentDescription&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"text-gray-900",children:a.paymentDescription})]})]}),J?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(U,{className:"animate-spin h-6 w-6 text-blue-500 mx-auto"}),e.jsx("p",{className:"text-gray-600",children:"Loading payment history..."})]}):u.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ge,{className:"h-10 w-10 text-gray-400 mx-auto"}),e.jsx("p",{className:"text-gray-600",children:"No payments made yet for this request."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-700",children:"All Payments"}),u.map((t,r)=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Amount"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:t.payment?.amount&&t.payment?.currency?`${t.payment.amount} ${t.payment.currency}`:"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Y(t.payment,a.status)}`,children:Z(t.payment,a.status)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.payment?.createdAt?new Date(t.payment.createdAt).toLocaleDateString():"Not specified"})]})]}),(t.payment?.paymentType||t.payment?.paymentMethod)&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[t.payment?.paymentType&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Payment Type:"}),e.jsx("span",{className:"ml-2 text-gray-900 capitalize",children:t.payment.paymentType==="photo_access"?"Photo Access":t.payment.paymentType==="full_details"?"Full Details Access":t.payment.paymentType})]}),t.payment?.paymentMethod&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Payment Method:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:t.payment.paymentMethod})]})]})}),t.payment?.confirmationName&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[e.jsx("h6",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Payment Confirmation Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Confirmed by:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:t.payment.confirmationName})]}),t.payment?.confirmationPhone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Phone:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:t.payment.confirmationPhone})]}),t.payment?.confirmationReference&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Reference:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:t.payment.confirmationReference})]}),t.payment?.confirmationDate&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Confirmed on:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:new Date(t.payment.confirmationDate).toLocaleDateString()})]})]})]}),t.payment?.status==="confirmed"&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Waiting for Admin Approval"}),e.jsx("p",{className:"mt-1 text-sm text-blue-700",children:"Your payment has been confirmed and is now waiting for admin approval. If this takes longer than expected, please message the admin or call for assistance."})]})]})})})]},t.id||r))]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(O,{className:"h-5 w-5 mr-2 text-blue-600"}),"Messages"]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[V?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(U,{className:"animate-spin h-6 w-6 text-blue-500 mx-auto"}),e.jsx("p",{className:"text-gray-600",children:"Loading messages..."})]}):f.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(O,{className:"h-10 w-10 text-gray-400 mx-auto"}),e.jsx("p",{className:"text-gray-600",children:"No messages yet for this request."})]}):e.jsx("div",{className:"space-y-4 max-h-60 overflow-y-auto",children:f.map(t=>e.jsx("div",{className:`flex ${t.fromAdmin?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${t.fromAdmin?"bg-white text-gray-900 border border-gray-200":"bg-blue-600 text-white"}`,children:[e.jsx("div",{className:"text-sm",children:t.content}),e.jsx("div",{className:`text-xs mt-1 ${t.fromAdmin?"text-gray-500":"text-blue-100"}`,children:new Date(t.createdAt).toLocaleString()})]})},t.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:k,onChange:t=>n(t.target.value),placeholder:"Type your message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:t=>t.key==="Enter"&&b()}),e.jsxs("button",{onClick:b,disabled:!k.trim()||V,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:"Send"})]})]})})]})]})]}),G&&i.canViewPhoto&&a.candidate.photo&&e.jsx(K,{isOpen:G,onClose:()=>A(!1),title:`${a.candidate.name} - Profile Photo`,maxWidth:"max-w-3xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:(()=>{const t=a.candidate.photo;return t?t.startsWith("http")?t:`${y.BASE_URL}/${t.replace(/^\/+/,"")}`:"/api/placeholder/400/400"})(),alt:a.candidate.name,className:"w-full max-h-96 object-contain rounded-lg",onError:t=>{t.target.src="/api/placeholder/400/400"}}),i.canDownloadPhoto&&e.jsxs("button",{onClick:()=>{const t=a.candidate.photo,r=t.startsWith("http")?t:`${y.BASE_URL}/${t.replace(/^\/+/,"")}`;w(r,a.candidate.name)},className:"absolute bottom-4 right-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 shadow-lg transition-colors",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:"Download"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900",children:a.candidate.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.candidate.skills})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:a.candidate.monthlyRate}),e.jsx("p",{className:"text-xs text-gray-500",children:"Monthly Rate"})]})]}),!i.canDownloadPhoto&&e.jsx("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-4 w-4 text-orange-500 mr-2"}),e.jsx("span",{className:"text-sm text-orange-700",children:"Download requires payment approval"})]})})]})})]})};class Ue{async getDashboardData(){try{console.log("ðŸ” employerDashboardService.getDashboardData called"),console.log("ðŸ” API endpoint:",M.EMPLOYER.DASHBOARD),console.log("ðŸ” Auth token:",localStorage.getItem("job_portal_token"));const c=await R.get(M.EMPLOYER.DASHBOARD);return console.log("âœ… API response:",c),c}catch(c){throw console.error("âŒ employerDashboardService.getDashboardData error:",c),console.error("âŒ Error response:",c.response),c}}async getRequestDetails(c){try{return(await R.get(M.EMPLOYER.GET_REQUEST_BY_ID(c))).data}catch(a){throw console.error("Error getting request details:",a),a}}async updateRequestStatus(c,a){try{return(await R.put(M.EMPLOYER.GET_REQUEST_BY_ID(c),{status:a})).data}catch(f){throw console.error("Error updating request status:",f),f}}async getRequestStats(){try{return(await R.get(M.EMPLOYER.GET_REQUESTS+"/stats")).data}catch(c){throw console.error("Error getting request stats:",c),c}}}const Oe=new Ue,Ke=()=>{const{user:Q}=Me(),[c,a]=d.useState(null),[f,k]=d.useState(!0),[n,b]=d.useState(null),[V,u]=d.useState([]),[J,B]=d.useState(!1),[S,X]=d.useState("all"),[j,G]=d.useState(""),[A,H]=d.useState(!1),[Z,Y]=d.useState(!1),[E,N]=d.useState([]),[v,w]=d.useState(""),[i,t]=d.useState(!1),[r,m]=d.useState(!1),[l,x]=d.useState({confirmationName:"",confirmationPhone:"",paymentReference:"",transferAmount:"",transferDate:"",notes:""}),[g,L]=d.useState(!1),[T,C]=d.useState(""),[de,q]=d.useState(""),F=async()=>{try{k(!0);const s=await Oe.getDashboardData();a(s)}catch(s){console.error("âŒ Error fetching dashboard data:",s),console.error("âŒ Error details:",{message:s.message,status:s.response?.status,statusText:s.response?.statusText,data:s.response?.data}),P.error("Failed to load dashboard data")}finally{k(!1)}},z=async s=>{t(!0);try{const o=localStorage.getItem("job_portal_token");if(console.log("Token found:",!!o,o?"exists":"missing"),!o){console.error("No authentication token found"),N([]);return}const p=await fetch(`${y.BASE_URL}/messaging/request/${s}`,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(console.log("Response status:",p.status),p.ok){const _=await p.json();N(_.messages||[])}else console.error("Failed to fetch messages, status:",p.status),N([])}catch(o){console.error("Error fetching messages:",o),N([])}finally{t(!1)}},be=async s=>{B(!0);try{const o=localStorage.getItem("job_portal_token"),p=await fetch(`${y.BASE_URL}/payments/details/${s}`,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(p.ok){const _=await p.json();if(_.payments&&Array.isArray(_.payments)){const De=_.payments.map(h=>({id:h.id,payment:{id:h.id,amount:h.amount,currency:h.currency,paymentMethod:h.paymentMethod,paymentType:h.paymentType,status:h.status,description:h.description,createdAt:h.createdAt,updatedAt:h.updatedAt,confirmationName:h.confirmationName,confirmationPhone:h.confirmationPhone,confirmationDate:h.confirmationDate,confirmationReference:h.confirmationReference,adminNotes:h.adminNotes}}));u(De)}else u([])}else console.error("Failed to fetch payment history, using latestPayment if available"),console.log("selectedRequest:",n),console.log("latestPayment:",n?.latestPayment),n?.latestPayment?(console.log("Setting paymentHistory with latestPayment:",n.latestPayment),u([n.latestPayment])):(console.log("No latestPayment found, setting empty array"),u([]))}catch(o){console.error("Error fetching payment history:",o),console.log("selectedRequest in catch:",n),console.log("latestPayment in catch:",n?.latestPayment),n?.latestPayment?(console.log("Setting paymentHistory with latestPayment in catch:",n.latestPayment),u([n.latestPayment])):(console.log("No latestPayment found in catch, setting empty array"),u([]))}finally{B(!1)}},ee=async()=>{if(!(!v.trim()||!n))try{t(!0),await ue.sendMessage(n.id,{content:v.trim(),messageType:"text"}),w(""),await z(n.id),P.success("Message sent successfully")}catch(s){console.error("Error sending message:",s),P.error("Failed to send message")}finally{t(!1)}},je=async s=>{b(s),H(!0),await z(s.id)},Ne=()=>{H(!1),b(null),N([]),w("")},ve=()=>{Y(!1),b(null),N([]),w(""),u([])},we=async()=>{if(n)try{await ue.markMessagesAsRead(n.id),await z(n.id)}catch(s){console.error("Error marking messages as read:",s)}},_e=s=>{b(s),Y(!0),z(s.id),be(s.id)},Pe=async s=>{if(!(!s||s.status!=="photo_access_granted"))try{const o=await fetch(`${y.BASE_URL}/employer/requests/${s.id}/request-full-details`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem(y.AUTH_CONFIG.tokenKey)}`},body:JSON.stringify({reason:""})}),p=await o.json();o.ok?(P.success("Full details request submitted. Admin will review your request."),F()):P.error(p.error||"Failed to request full details.")}catch{P.error("Network error. Please try again.")}};d.useEffect(()=>{F()},[]),d.useEffect(()=>{A&&n&&we()},[A,n]);const Ae=s=>{console.log("ðŸ” PAYMENT MODAL DEBUG:",{request_id:s.id,status:s.status,latestPayment_exists:!!s.latestPayment,latestPayment_id:s.latestPayment?.id,latestPayment_amount:s.latestPayment?.amount,paymentMethod_exists:!!s.latestPayment?.paymentMethod,paymentMethod_name:s.latestPayment?.paymentMethod?.name,full_latestPayment:s.latestPayment}),b(s),m(!0),x({confirmationName:"",confirmationPhone:"",paymentReference:"",transferAmount:"",transferDate:"",notes:""}),C(""),q("")},te=()=>{m(!1),x({confirmationName:"",confirmationPhone:"",paymentReference:"",transferAmount:"",transferDate:"",notes:""}),C(""),q("")},Se=async s=>{if(s.preventDefault(),!l.confirmationName||!l.confirmationPhone){C("Please provide your name and phone number");return}try{L(!0),C("");const o=await fetch(`${y.BASE_URL}/payment-confirmations/confirm`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem(y.AUTH_CONFIG.tokenKey)}`},body:JSON.stringify({paymentId:n.latestPayment?.id,confirmationName:l.confirmationName,confirmationPhone:l.confirmationPhone,paymentReference:l.paymentReference,transferAmount:n.latestPayment?.amount||n.paymentAmount,transferDate:l.transferDate,notes:l.notes})}),p=await o.json();if(o.ok)P.success("Payment confirmation submitted successfully!"),te(),F(),x({confirmationName:"",confirmationPhone:"",paymentReference:"",transferAmount:"",transferDate:"",notes:""}),q("Payment confirmation submitted successfully!");else{const _=p.error||"Failed to submit payment confirmation";C(_),P.error(_)}}catch(o){console.error("Error submitting payment confirmation:",o),C("Network error. Please try again.")}finally{L(!1)}},se=c?.requests?.filter(s=>{const o=S==="all"||s.status===S,p=s.candidate?.name?.toLowerCase().includes(j.toLowerCase())||s.candidate?.skills?.toLowerCase().includes(j.toLowerCase());return o&&p})||[],me=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"first_payment_required":return"bg-orange-100 text-orange-800 border-orange-200";case"first_payment_confirmed":return"bg-purple-100 text-purple-800 border-purple-200";case"photo_access_granted":return"bg-blue-100 text-blue-800 border-blue-200";case"full_details_requested":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"second_payment_required":return"bg-orange-100 text-orange-800 border-orange-200";case"second_payment_confirmed":return"bg-purple-100 text-purple-800 border-purple-200";case"full_access_granted":return"bg-green-100 text-green-800 border-green-200";case"hiring_decision_made":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"hired":return"bg-green-200 text-green-900 border-green-300";case"available":return"bg-blue-200 text-blue-900 border-blue-300";case"process_complete":return"bg-gray-200 text-gray-900 border-gray-300";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"completed":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},xe=s=>{switch(s){case"urgent":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"normal":return"bg-blue-100 text-blue-800 border-blue-200";case"low":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},pe=s=>{switch(s.status){case"pending":return 10;case"approved":return 20;case"first_payment_required":return 30;case"first_payment_confirmed":return 40;case"photo_access_granted":return 50;case"full_details_requested":return 60;case"second_payment_required":return 70;case"second_payment_confirmed":return 80;case"full_access_granted":return 90;case"hiring_decision_made":return 95;case"hired":return 100;case"available":return 100;case"process_complete":return 100;case"cancelled":return 0;case"completed":return 100;default:return 0}},he=s=>s>=80?"bg-green-500":s>=60?"bg-blue-500":s>=40?"bg-yellow-500":"bg-red-500";if(f)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(U,{className:"animate-spin h-12 w-12 text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading your dashboard..."})]})});if(!c)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load dashboard data"}),e.jsx("button",{onClick:F,className:"mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Try Again"})]})});const Ce=[{title:"Total Requests",value:c.stats.totalRequests,icon:ce,color:"bg-blue-500"},{title:"Pending Payments",value:c.stats.paymentRequired,icon:oe,color:"bg-yellow-500"},{title:"Approved Requests",value:c.stats.approvedRequests,icon:$,color:"bg-green-500"},{title:"Unread Messages",value:c.stats.unreadMessages,icon:O,color:"bg-purple-500"}];return e.jsxs("div",{className:"min-h-screen bg-gray-50 relative",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Employer Dashboard"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Welcome back, ",c.employer?.name||"Employer","! Manage your job seeker requests and payments"]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("button",{onClick:F,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx("span",{children:"Refresh"})]})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:Ce.map((s,o)=>e.jsx(ye.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:o*.1},className:"bg-white rounded-xl shadow-sm border p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:s.value})]}),e.jsx("div",{className:`${s.color} p-3 rounded-lg`,children:e.jsx(s.icon,{className:"h-6 w-6 text-white"})})]})},s.title))}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search candidates or skills...",value:j,onChange:s=>G(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:S,onChange:s=>X(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewing",children:"Reviewing"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"first_payment_required",children:"First Payment Required"}),e.jsx("option",{value:"first_payment_confirmed",children:"First Payment Confirmed"}),e.jsx("option",{value:"photo_access_granted",children:"Photo Access Granted"}),e.jsx("option",{value:"full_details_requested",children:"Full Details Requested"}),e.jsx("option",{value:"second_payment_required",children:"Second Payment Required"}),e.jsx("option",{value:"second_payment_confirmed",children:"Second Payment Confirmed"}),e.jsx("option",{value:"full_access_granted",children:"Full Access Granted"}),e.jsx("option",{value:"hiring_decision_made",children:"Hiring Decision Made"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"payment_required",children:"Payment Required (Legacy)"}),e.jsx("option",{value:"payment_confirmed",children:"Payment Confirmed (Legacy)"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsxs("span",{children:[se.length," of ",c.stats.totalRequests," requests"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Your Requestsyyy"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Candidate"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Skills & Experience"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Priority"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:se.map(s=>{const o=pe(s);return e.jsxs(ye.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.candidate?.name||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Requested ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:s.candidate?.skills||"Not specified"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.candidate?.experienceLevel||"Not specified"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${me(s.status)}`,children:s.status.replace("_"," ").replace(/\b\w/g,p=>p.toUpperCase())})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${xe(s.priority)}`,children:s.priority.charAt(0).toUpperCase()+s.priority.slice(1)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${he(o)}`,style:{width:`${o}%`}})}),e.jsxs("span",{className:"text-sm text-gray-500",children:[o,"%"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>je(s),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md text-xs transition-colors flex items-center space-x-1",children:[e.jsx(O,{className:"h-3 w-3"}),e.jsx("span",{children:"Message"})]}),e.jsx("button",{onClick:()=>_e(s),className:"text-blue-600 hover:text-blue-900 text-xs",children:"View Details"}),(s.status==="payment_required"||s.status==="first_payment_required"||s.status==="second_payment_required")&&s.paymentRequired&&e.jsxs("button",{onClick:()=>Ae(s),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-xs transition-colors flex items-center space-x-1",children:[e.jsx(oe,{className:"h-3 w-3"}),e.jsx("span",{children:"Confirm Payment"})]}),s.status==="photo_access_granted"&&e.jsxs("button",{onClick:()=>Pe(s),className:"bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded-md text-xs transition-colors flex items-center space-x-1",children:[e.jsx(I,{className:"h-3 w-3"}),e.jsx("span",{children:"Request Full Details"})]})]})})]},s.id)})})]})})]}),se.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ce,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No requests found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:j||S!=="all"?"Try adjusting your search or filters.":"Get started by submitting your first job seeker request."})]})]}),A&&n&&e.jsxs(K,{isOpen:A,onClose:Ne,title:"Messages",maxWidth:"max-w-2xl",children:[e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50",children:i?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"animate-spin h-8 w-8 text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading messages..."})]}):E.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Start the conversation!"})]}):E.map(s=>e.jsx("div",{className:`flex ${s.fromAdmin?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg shadow-sm ${s.fromAdmin?"bg-white text-gray-900 border border-gray-200":"bg-blue-600 text-white"}`,children:[e.jsx("div",{className:"text-sm",children:s.content}),e.jsx("div",{className:`text-xs mt-1 ${s.fromAdmin?"text-gray-500":"text-blue-100"}`,children:new Date(s.createdAt).toLocaleString()})]})},s.id))}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-white rounded-b-xl",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:v,onChange:s=>w(s.target.value),placeholder:"Type your message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:s=>s.key==="Enter"&&ee()}),e.jsxs("button",{onClick:ee,disabled:!v.trim()||i,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:"Send"})]})]})})]}),e.jsx(Ie,{isOpen:Z&&n,onClose:ve,selectedRequest:n,messages:E,newMessage:v,setNewMessage:w,sendMessage:ee,messagingLoading:i,paymentHistory:V,loadingPaymentHistory:J,getStatusColor:me,getPriorityColor:xe,getProgressColor:he,getProgressPercentage:pe}),r&&n&&e.jsx(K,{isOpen:r,onClose:te,title:"Confirm Payment",maxWidth:"max-w-2xl",children:e.jsx("div",{className:"flex-1 p-6 bg-gray-50",children:e.jsxs("form",{onSubmit:Se,className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"Payment Details:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Amount:"}),e.jsx("span",{className:"text-blue-900 font-semibold",children:n.latestPayment?`${n.latestPayment.amount} ${n.latestPayment.currency}`:`${n.paymentAmount} ${n.paymentCurrency}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Description:"}),e.jsx("span",{className:"text-blue-900",children:n.latestPayment?.description||(n.status==="second_payment_required"?"Second payment for full candidate details access":"First payment for candidate photo access")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Payment Type:"}),e.jsx("span",{className:"text-blue-900 capitalize",children:n.latestPayment?.paymentType?.replace("_"," ")||"First Installment"})]}),n.latestPayment?.paymentMethod&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Payment Method:"}),e.jsx("span",{className:"text-blue-900",children:n.latestPayment.paymentMethod.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Account Name:"}),e.jsx("span",{className:"text-blue-900",children:n.latestPayment.paymentMethod.accountName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Account Number:"}),e.jsx("span",{className:"text-blue-900 font-mono",children:n.latestPayment.paymentMethod.accountNumber})]}),n.latestPayment.paymentMethod.bankName&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Bank:"}),e.jsx("span",{className:"text-blue-900",children:n.latestPayment.paymentMethod.bankName})]})]}),!n.latestPayment?.paymentMethod&&e.jsx("div",{className:"text-amber-700 text-xs bg-amber-50 p-2 rounded border border-amber-200",children:"âš ï¸ Payment method details not available. Please contact admin for payment instructions."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Your Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.confirmationName,onChange:s=>x({...l,confirmationName:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"As shown on transfer",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",value:l.confirmationPhone,onChange:s=>x({...l,confirmationPhone:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+250123456789",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Amount (Admin Requested)"}),e.jsx("input",{type:"number",value:n.latestPayment?.amount||n.paymentAmount||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 cursor-not-allowed",placeholder:"Amount set by admin",min:"0",step:"100",readOnly:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This amount cannot be changed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Date"}),e.jsx("input",{type:"date",value:l.transferDate,onChange:s=>x({...l,transferDate:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",max:new Date().toISOString().split("T")[0]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{value:l.notes,onChange:s=>x({...l,notes:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",placeholder:"Any additional information about your payment..."})]}),T&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg border border-red-200",children:T}),de&&e.jsx("div",{className:"text-sm text-green-600 bg-green-50 p-3 rounded-lg border border-green-200",children:de}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:te,disabled:g,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg disabled:opacity-50 flex items-center space-x-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:"Confirm Payment"})]})})]})]})})}),e.jsx(Fe,{position:"top-right"})]})};export{Ke as default};
