import{j as e,az as H,aA as $,aB as U,c as Y,r as b,a9 as T,a2 as F,U as K,s as Q,O as V,aC as X,aD as ee,ak as j,al as re,am as _}from"./vendor-react-BkwhrffK.js";import{l as d,n as g,h as u,L as se,B as m,C as h}from"./index-BwJdDrjx.js";import{ab as te,a$ as ae,b0 as oe,b1 as ne,b2 as ie,b3 as le,b4 as ce,b5 as de,b6 as ge,b7 as ue}from"./vendor-common-BZD0eUgH.js";let w=null,x=null;const M=300*1e3,A={getDashboardStats:async()=>{try{return{success:!0,data:(await d.get("/dashboard/stats",{headers:g()})).data}}catch(s){return s.response?.data?.error?{success:!1,error:s.response.data.error}:{success:!1,error:u(s,{context:"get_dashboard_stats"}).userMessage}}},getAnalytics:async(s={})=>{try{const{period:r=30,...n}=s,t=new URLSearchParams({period:r.toString(),...n});return{success:!0,data:(await d.get(`/dashboard/analytics?${t}`,{headers:g()})).data}}catch(r){return r.response?.data?.error?{success:!1,error:r.response.data.error}:{success:!1,error:u(r,{context:"get_analytics"}).userMessage}}},getSystemSettings:async()=>{try{return{success:!0,data:(await d.get("/settings",{headers:g()})).data.settings}}catch(s){return s.response?.data?.error?{success:!1,error:s.response.data.error}:{success:!1,error:u(s,{context:"get_system_settings"}).userMessage}}},updateSystemSettings:async s=>{try{const r=await d.put("/settings",s,{headers:g()});return{success:!0,data:r.data.settings,message:r.data.message}}catch(r){if(r.response?.data){const{data:t}=r.response;if(t.details&&Array.isArray(t.details))return{success:!1,error:t.details.map(i=>`${i.field}: ${i.message}`).join(", ")};if(t.error)return{success:!1,error:t.error};if(t.message)return{success:!1,error:t.message}}return{success:!1,error:u(r,{context:"update_system_settings"}).userMessage}}},getAdminProfile:async(s=!1)=>{try{if(!s&&w&&x&&Date.now()-x<M)return{success:!0,data:w,fromCache:!0};const r=await d.get("/profile/me",{headers:g()});return w=r.data,x=Date.now(),{success:!0,data:r.data}}catch(r){return r.response?.data?.error?{success:!1,error:r.response.data.error}:{success:!1,error:u(r,{context:"get_admin_profile"}).userMessage}}},updateAdminProfile:async s=>{try{const r=await d.put("/profile/me",s,{headers:g()});return w=null,x=null,{success:!0,data:r.data.profile,message:r.data.message}}catch(r){if(r.response?.data){const{data:t}=r.response;if(t.details&&Array.isArray(t.details))return{success:!1,error:t.details.map(i=>`${i.field}: ${i.message}`).join(", ")};if(t.error)return{success:!1,error:t.error};if(t.message)return{success:!1,error:t.message}}return{success:!1,error:u(r,{context:"update_admin_profile"}).userMessage}}},changeAdminPassword:async s=>{try{return{success:!0,message:(await d.put("/security/change-password",s,{headers:g()})).data.message}}catch(r){if(r.response?.data){const{data:t}=r.response;if(t.details&&Array.isArray(t.details))return{success:!1,error:t.details.map(i=>`${i.field}: ${i.message}`).join(", ")};if(t.error)return{success:!1,error:t.error};if(t.message)return{success:!1,error:t.message}}return{success:!1,error:u(r,{context:"change_admin_password"}).userMessage}}},getSystemHealth:async()=>{try{return{success:!0,data:(await d.get("/admin/health",{headers:g()})).data}}catch(s){return s.response?.data?.error?{success:!1,error:s.response.data.error}:{success:!1,error:u(s,{context:"get_system_health"}).userMessage}}},getSystemLogs:async(s={})=>{try{const{page:r=1,limit:n=50,level:t,startDate:o,endDate:i,...p}=s,l=new URLSearchParams({page:r.toString(),limit:n.toString(),...p});t&&l.append("level",t),o&&l.append("startDate",o),i&&l.append("endDate",i);const D=await d.get(`/admin/logs?${l}`,{headers:g()});return{success:!0,data:D.data.logs,pagination:D.data.pagination}}catch(r){return r.response?.data?.error?{success:!1,error:r.response.data.error}:{success:!1,error:u(r,{context:"get_system_logs"}).userMessage}}},exportSystemData:async(s={})=>{try{const{type:r="all",format:n="pdf",startDate:t,endDate:o,...i}=s,p=new URLSearchParams({type:r,format:n,...i});t&&p.append("startDate",t),o&&p.append("endDate",o);const l=await d.get(`/admin/export?${p}`,{headers:g(),responseType:n==="pdf"?"arraybuffer":"text"});return{success:!0,data:l.data,filename:l.headers["content-disposition"]?.split("filename=")[1]||`export-${r}-${new Date().toISOString().split("T")[0]}.${n}`}}catch(r){return r.response?.data?.error?{success:!1,error:r.response.data.error}:{success:!1,error:u(r,{context:"export_system_data"}).userMessage}}},getPlatformStats:async()=>{try{return{success:!0,data:(await d.get("/admin/platform-stats",{headers:g()})).data}}catch(s){return s.response?.data?.error?{success:!1,error:s.response.data.error}:{success:!1,error:u(s,{context:"get_platform_stats"}).userMessage}}},async updateAdminAvatar(s){try{const r=new FormData;r.append("avatar",s);const n=await d.put("/admin/avatar",r,{headers:{...g(),"Content-Type":"multipart/form-data"}});return w=null,x=null,n.data}catch(r){throw console.error("Error updating admin avatar:",r),r}},async getSystemSettings(){try{return(await d.get("/admin/settings",{headers:g()})).data}catch(s){throw console.error("Error fetching system settings:",s),s}},async updateSystemSettings(s){try{return(await d.put("/admin/settings",s,{headers:g()})).data}catch(r){throw console.error("Error updating system settings:",r),r}},clearProfileCache(){w=null,x=null},getProfileCacheStatus(){if(!w||!x)return{cached:!1,age:null};const s=Date.now()-x;return{cached:!0,age:s,valid:s<M}}};te.register(ae,oe,ne,ie,le,ce,de,ge,ue);const O=({data:s,title:r="Growth Trend"})=>{const n={labels:s.map(o=>new Date(o.date).toLocaleDateString()),datasets:[{label:"Count",data:s.map(o=>o.count),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0}]},t={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:r,font:{size:16,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"}},x:{grid:{color:"rgba(0, 0, 0, 0.1)"}}}};return e.jsx(H,{data:n,options:t})},pe=({data:s,title:r="Top Categories"})=>{const n={labels:s.map(o=>o.name),datasets:[{label:"Job Seekers",data:s.map(o=>o.count),backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)","rgba(34, 197, 94, 0.8)","rgba(251, 146, 60, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(16, 185, 129)","rgb(245, 158, 11)","rgb(239, 68, 68)","rgb(139, 92, 246)","rgb(236, 72, 153)","rgb(34, 197, 94)","rgb(251, 146, 60)"],borderWidth:2}]},t={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:r,font:{size:16,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"}},x:{grid:{color:"rgba(0, 0, 0, 0.1)"}}}};return e.jsx($,{data:n,options:t})},me=({data:s,title:r="Top Locations"})=>{const n={labels:s.map(o=>`${o.city}, ${o.country}`),datasets:[{label:"Job Seekers",data:s.map(o=>o.count),backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(16, 185, 129)","rgb(245, 158, 11)","rgb(239, 68, 68)","rgb(139, 92, 246)"],borderWidth:2}]},t={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:r,font:{size:16,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"}},x:{grid:{color:"rgba(0, 0, 0, 0.1)"}}}};return e.jsx($,{data:n,options:t})},he=({data:s,title:r="Top Skills in Demand"})=>{const n={labels:s.map(o=>o.skill),datasets:[{label:"Mentions",data:s.map(o=>o.count),backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)","rgba(34, 197, 94, 0.8)","rgba(251, 146, 60, 0.8)","rgba(6, 182, 212, 0.8)","rgba(168, 85, 247, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(16, 185, 129)","rgb(245, 158, 11)","rgb(239, 68, 68)","rgb(139, 92, 246)","rgb(236, 72, 153)","rgb(34, 197, 94)","rgb(251, 146, 60)","rgb(6, 182, 212)","rgb(168, 85, 247)"],borderWidth:2}]},t={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:r,font:{size:16,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"}},x:{grid:{color:"rgba(0, 0, 0, 0.1)"}}}};return e.jsx($,{data:n,options:t})},be=({data:s,title:r="Skills Distribution"})=>{const n={labels:s.map(o=>o.skill),datasets:[{data:s.map(o=>o.count),backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)","rgba(34, 197, 94, 0.8)","rgba(251, 146, 60, 0.8)","rgba(6, 182, 212, 0.8)","rgba(168, 85, 247, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(16, 185, 129)","rgb(245, 158, 11)","rgb(239, 68, 68)","rgb(139, 92, 246)","rgb(236, 72, 153)","rgb(34, 197, 94)","rgb(251, 146, 60)","rgb(6, 182, 212)","rgb(168, 85, 247)"],borderWidth:2}]},t={responsive:!0,plugins:{legend:{position:"right"},title:{display:!0,text:r,font:{size:16,weight:"bold"}}}};return e.jsx(U,{data:n,options:t})},xe=({data:s,title:r="Categories Distribution"})=>{const n={labels:s.map(o=>o.name),datasets:[{data:s.map(o=>o.count),backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)","rgba(34, 197, 94, 0.8)","rgba(251, 146, 60, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(16, 185, 129)","rgb(245, 158, 11)","rgb(239, 68, 68)","rgb(139, 92, 246)","rgb(236, 72, 153)","rgb(34, 197, 94)","rgb(251, 146, 60)"],borderWidth:2}]},t={responsive:!0,plugins:{legend:{position:"right"},title:{display:!0,text:r,font:{size:16,weight:"bold"}}}};return e.jsx(U,{data:n,options:t})},fe=()=>{const{t:s}=Y(),[r,n]=b.useState("30"),[t,o]=b.useState("all"),[i,p]=b.useState(!1),[l,D]=b.useState(null),[G,L]=b.useState(!0),[z,E]=b.useState(""),[N,I]=b.useState(null);b.useEffect(()=>{R()},[r]);const R=async()=>{try{L(!0),E("");const[a,c]=await Promise.all([A.getAnalytics({period:r}),A.getDashboardStats()]);a.success?D(a.data):E(a.error||"Failed to load analytics data"),c.success?I(c.data):console.error("Failed to load dashboard stats:",c.error)}catch(a){console.error("Error loading report data:",a),E("Network error. Please try again.")}finally{L(!1)}},B=[{value:"7",label:"Last 7 Days"},{value:"30",label:"Last 30 Days"},{value:"90",label:"Last 90 Days"},{value:"365",label:"Last Year"}],J=a=>{n(a)},f=async a=>{p(!0);try{const c=await A.exportSystemData({type:a,format:"pdf",startDate:new Date(Date.now()-parseInt(r)*24*60*60*1e3).toISOString(),endDate:new Date().toISOString()});if(c.success){const y=c.data,C=new Blob([y],{type:"application/pdf"}),v=window.URL.createObjectURL(C),S=document.createElement("a");S.href=v,S.download=c.filename||`report-${a}-${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(S),S.click(),window.URL.revokeObjectURL(v),document.body.removeChild(S),_.success(`${a} report exported successfully as PDF!`)}else _.error(`Failed to export report: ${c.error}`)}catch(c){console.error("Error exporting report:",c),_.error("Error exporting report. Please try again.")}finally{p(!1)}},W=async()=>{p(!0);try{await R()}catch(a){console.error("Error refreshing data:",a),E("Failed to refresh data. Please try again.")}finally{p(!1)}};if(G)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(se,{size:"lg",text:"Loading reports..."})});if(z)return e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md mx-auto",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-red-600"})})}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Error Loading Reports"}),e.jsx("p",{className:"text-red-600 mb-4",children:z}),e.jsxs(m,{onClick:R,variant:"outline",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})});if(!l||!N)return e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 max-w-md mx-auto",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-gray-600"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Report Data Available"}),e.jsx("p",{className:"text-gray-600",children:"There is no data available for the selected period."})]})});const q=a=>{if(!a||a.length<2)return 0;const c=a.slice(-7).reduce((C,v)=>C+v.count,0),y=a.slice(-14,-7).reduce((C,v)=>C+v.count,0);return y===0?c>0?100:0:Math.round((c-y)/y*100)},k=q(l.growth?.jobSeekers),P=q(l.growth?.employerRequests),Z=[{title:"Total Job Seekers",value:N.overview?.totalJobSeekers?.toString()||"0",change:k>0?`+${k}%`:`${k}%`,changeType:k>=0?"increase":"decrease",icon:K,color:"text-blue-600",bgColor:"bg-blue-50",description:"All registered job seekers"},{title:"Total Requests",value:N.overview?.totalEmployerRequests?.toString()||"0",change:P>0?`+${P}%`:`${P}%`,changeType:P>=0?"increase":"decrease",icon:Q,color:"text-green-600",bgColor:"bg-green-50",description:"All employer requests"},{title:"Pending Requests",value:N.overview?.pendingEmployerRequests?.toString()||"0",change:"",changeType:"neutral",icon:V,color:"text-orange-600",bgColor:"bg-orange-50",description:"Requests awaiting response"},{title:"Categories",value:N.overview?.totalCategories?.toString()||"0",change:"",changeType:"neutral",icon:T,color:"text-purple-600",bgColor:"bg-purple-50",description:"Active job categories"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Reports & Analytics"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive insights and performance metrics"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(m,{onClick:W,variant:"outline",disabled:i,className:"flex items-center gap-2",children:[e.jsx(F,{className:`w-4 h-4 ${i?"animate-spin":""}`}),i?"Refreshing...":"Refresh"]})})]}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Period"}),e.jsx("select",{value:r,onChange:a=>J(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:B.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:Z.map((a,c)=>{const y=a.icon;return e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.value}),a.change&&e.jsxs("div",{className:"flex items-center mt-2",children:[a.changeType==="increase"?e.jsx(X,{className:"w-4 h-4 text-green-500 mr-1"}):a.changeType==="decrease"?e.jsx(ee,{className:"w-4 h-4 text-red-500 mr-1"}):null,e.jsx("span",{className:`text-sm ${a.changeType==="increase"?"text-green-600":a.changeType==="decrease"?"text-red-600":"text-gray-600"}`,children:a.change})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a.description})]}),e.jsx("div",{className:`w-12 h-12 ${a.bgColor} rounded-lg flex items-center justify-center`,children:e.jsx(y,{className:`w-6 h-6 ${a.color}`})})]})},c)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.growth&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Job Seeker Growth"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>f("job-seekers"),disabled:i,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]}),e.jsx("div",{className:"h-80",children:e.jsx(O,{data:l.growth.jobSeekers||[],title:"Job Seeker Growth Trend"})})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Employer Request Growth"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>f("employer-requests"),disabled:i,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]}),e.jsx("div",{className:"h-80",children:e.jsx(O,{data:l.growth.employerRequests||[],title:"Employer Request Growth Trend"})})]})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Categories"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>f("categories"),disabled:i,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]}),e.jsx("div",{className:"h-80",children:e.jsx(pe,{data:l.categories?.top||[],title:"Top Job Categories"})})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Locations"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>f("locations"),disabled:i,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]}),e.jsx("div",{className:"h-80",children:e.jsx(me,{data:l.locations||[],title:"Geographic Distribution"})})]}),l.skills&&l.skills.length>0&&e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Skills in Demand"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>f("skills"),disabled:i,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]}),e.jsx("div",{className:"h-80",children:e.jsx(he,{data:l.skills.slice(0,10)||[],title:"Most Requested Skills"})})]}),l.skills&&l.skills.length>0&&e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Skills Distribution"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>f("skills"),disabled:i,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]}),e.jsx("div",{className:"h-80",children:e.jsx(be,{data:l.skills.slice(0,8)||[],title:"Skills Distribution"})})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Categories Distribution"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>f("categories"),disabled:i,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]}),e.jsx("div",{className:"h-80",children:e.jsx(xe,{data:l.categories?.top?.slice(0,8)||[],title:"Categories Distribution"})})]})]}),e.jsx(re,{position:"top-right"})]})},ve=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"}));export{fe as R,A as a,ve as b};
