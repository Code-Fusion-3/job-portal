import{aX as le,j as e,aM as ie,b4 as I,bc as ne,bT as ce,b2 as $,r as l,ae as M,af as T,b6 as _}from"./vendor-react-DetuyqZR.js";import{C as f,B as o,u as oe,v as de,l as me,o as xe,i as D}from"./index-DdcngoYs.js";import{u as he}from"./useApprovalManagement-BSSpEHdM.js";import{S as H}from"./StatusBadge-Bkx3X7LH.js";import{R as pe}from"./RejectionReasonModal-BCE-ieOX.js";import{L as X}from"./vendor-router-CcGrsq4S.js";import{m as x}from"./vendor-motion-CjTzmV1J.js";import"./vendor-gsap-B4nt0ofr.js";import"./Modal-mFCdD2fS.js";class ue extends le.Component{constructor(r){super(r),this.state={hasError:!1,error:null,errorInfo:null,retryCount:0}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,a){console.error("ApprovalErrorBoundary caught an error:",r,a),this.setState({error:r,errorInfo:a,hasError:!0}),this.props.onError&&this.props.onError(r,a)}handleRetry=()=>{this.setState(r=>({hasError:!1,error:null,errorInfo:null,retryCount:r.retryCount+1}))};render(){if(this.state.hasError){const{error:r,errorInfo:a,retryCount:i}=this.state,{fallback:m,showDetails:z=!1}=this.props;return m?e.jsx(m,{error:r,errorInfo:a,retry:this.handleRetry,retryCount:i}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs(f,{className:"max-w-2xl w-full p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(ie,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"An error occurred in the approval system. This might be a temporary issue."}),i>0&&e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Retry attempts: ",i]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(o,{onClick:this.handleRetry,variant:"primary",className:"flex items-center justify-center gap-2",disabled:i>=3,children:[e.jsx(I,{className:"w-4 h-4"}),i>=3?"Max retries reached":"Try Again"]}),e.jsxs(o,{as:X,to:"/",variant:"outline",className:"flex items-center justify-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Go to Homepage"]}),e.jsxs(o,{as:X,to:"/contact",variant:"outline",className:"flex items-center justify-center gap-2 text-blue-600 border-blue-300 hover:bg-blue-50",children:[e.jsx(ce,{className:"w-4 h-4"}),"Contact Support"]})]}),z&&r&&e.jsxs("details",{className:"mt-8 text-left",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"Technical Details"}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-100 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Error:"}),e.jsx("p",{className:"text-sm text-gray-700 mb-4 font-mono",children:r.toString()}),a&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Stack Trace:"}),e.jsx("pre",{className:"text-xs text-gray-600 overflow-auto bg-white p-2 rounded border",children:a.componentStack})]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500",children:"If this problem persists, please contact our support team with the error details above."})})]})})}return this.props.children}}const je=({count:d=3})=>e.jsx("div",{className:"space-y-4",children:Array.from({length:d}).map((r,a)=>e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1},className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded animate-pulse w-32"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-48"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-20"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-24"})]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-20"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-20"})]})]})},a))}),ge=()=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Array.from({length:3}).map((d,r)=>e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.1},className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-24"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-16"})]}),e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg animate-pulse"})]})},r))}),fe=({retryCount:d,maxRetries:r=3,onRetry:a,className:i=""})=>{const m=d<r;return e.jsxs(x.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:`flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-lg ${i}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx($,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800",children:m?"Operation failed":"Max retries reached"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["Retry attempt: ",d," of ",r]})]})]}),m&&a&&e.jsx("button",{onClick:a,className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm font-medium",children:"Retry"})]})},Ee=()=>{const{user:d}=oe(),[r,a]=l.useState(!1),[i,m]=l.useState(null),[z,ye]=l.useState(""),[G,B]=l.useState(""),[Y,h]=l.useState(""),[N,F]=l.useState(!1),[v,p]=l.useState(!1),{pendingProfiles:u,approvedProfiles:b,rejectedProfiles:w,loading:c,error:L,retryCount:C,approveProfile:q,rejectProfile:O,fetchProfilesByStatus:Q,currentPage:J,pagination:R,nextPage:K,prevPage:V,hasNextPage:W,hasPrevPage:Z,clearError:g,hasError:ee,isRetrying:se}=he({autoFetch:!0,itemsPerPage:20}),P=l.useMemo(()=>({approve:q,reject:O}),[q,O]),S=l.useMemo(()=>({pending:u.length,approved:b.length,rejected:w.length}),[u.length,b.length,w.length]);l.useEffect(()=>{if(N){const s=setTimeout(()=>{F(!1),B("")},3e3);return()=>clearTimeout(s)}},[N]),l.useEffect(()=>{if(v){const s=setTimeout(()=>{p(!1),h("")},5e3);return()=>clearTimeout(s)}},[v]);const U=l.useCallback(async(s,t,j=null)=>{try{if(!de(s)){const y=`Invalid profile ID provided: ${s}`;h(y),p(!0),console.error("❌ handleApprovalChange validation error:",y);return}me(t,{id:s},{component:"ApprovalQueue",reason:j||"N/A"});let n;if(t==="approved")n=await P.approve(s);else if(t==="rejected"){if(!j){h("Rejection reason is required"),p(!0);return}n=await P.reject(s,j)}n&&n.success?(B(n.message||`Profile ${t} successfully`),F(!0),g()):n&&(h(n.error||`Failed to ${t} profile`),p(!0))}catch(n){h(`Failed to ${t} profile`),p(!0),console.error("❌ Approval change error:",n)}},[P,g]),te=s=>{if(!s){console.error("❌ handleRejectionRequest: No profile provided");return}if(!D(s)){console.error("❌ handleRejectionRequest: Could not extract profile ID from profile:",s),h("Error: Could not determine profile ID. Please try again."),p(!0);return}m(s),a(!0)},re=async s=>{if(i){const t=D(i);t?(await U(t,"rejected",s),a(!1),m(null)):(h("Error: Could not determine profile ID for rejection"),p(!0),console.error("❌ handleRejectionSubmit: Could not extract profile ID from selectedProfile:",i))}},A=l.useCallback(s=>xe(s),[]),E=l.useCallback(s=>{const t=s.profile?.photo||s.photo;return t?/^https?:\/\//i.test(t)?t:`http://localhost:3000/${t.replace(/^\//,"")}`:null},[]),ae=l.useCallback(s=>{const t=s.profile?.firstName||s.firstName||"",j=s.profile?.lastName||s.lastName||"",n=t?t.charAt(0).toUpperCase():"",y=j?j.charAt(0).toUpperCase():"";return`${n}${y}`||"U"},[]),k=l.useCallback(async()=>{g(),await Q("pending",1)},[g,Q]);return!d||d.role!=="admin"?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(M,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."})]})}):e.jsx(ue,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Approval Queue"}),e.jsx("p",{className:"text-gray-600",children:"Review and approve pending job seeker profiles"}),se&&e.jsxs("p",{className:"text-sm text-yellow-600 mt-1",children:["Retrying operation... (Attempt ",C,")"]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(o,{onClick:k,variant:"outline",disabled:c,className:"flex items-center gap-2",children:[e.jsx(I,{className:`w-4 h-4 ${c?"animate-spin":""}`}),"Refresh"]})})]}),N&&e.jsx(x.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-green-700",children:G})]})}),v&&e.jsx(x.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-red-700",children:Y})]})}),c&&u.length===0&&b.length===0&&w.length===0?e.jsx(ge,{}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Review"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:S.pending})]}),e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-yellow-600"})})]})})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approved Today"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:S.approved})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rejected Today"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:S.rejected})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-red-600"})})]})})})]}),e.jsx(f,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Pending Profiles (",u.length,")"]}),e.jsx(H,{status:"pending",size:"lg"})]}),ee&&C>0&&e.jsx(fe,{retryCount:C,onRetry:k,className:"mb-6"}),c&&u.length===0?e.jsx(je,{count:5}):L?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-5 h-5 text-red-500"}),e.jsxs("span",{className:"text-red-700",children:["Error: ",L]})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs(o,{onClick:k,variant:"outline",size:"sm",disabled:c,children:[e.jsx(I,{className:`w-4 h-4 mr-2 ${c?"animate-spin":""}`}),"Retry"]}),e.jsx(o,{onClick:g,variant:"ghost",size:"sm",children:"Dismiss"})]})]}):u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No pending profiles"}),e.jsx("p",{className:"text-gray-600",children:"All job seeker profiles have been reviewed."})]}):e.jsx("div",{className:"space-y-4",children:u.map(s=>e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center",children:[E(s)?e.jsx("img",{src:E(s),alt:A(s),className:"w-full h-full object-cover",onError:t=>{t.currentTarget.style.display="none",t.currentTarget.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-300 text-lg font-semibold text-white",style:{display:E(s)?"none":"flex"},children:ae(s)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:A(s)}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email||"No email"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:s.profile?.location||"No location"}),s.profile?.experienceLevel&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:s.profile.experienceLevel.replace("_"," ")})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{status:"pending",size:"sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{onClick:()=>{const t=D(s);t?U(t,"approved"):(h("Error: Could not determine profile ID for approval"),p(!0))},variant:"primary",size:"sm",disabled:c,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Approve"]}),e.jsxs(o,{onClick:()=>te(s),variant:"danger",size:"sm",disabled:c,children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Reject"]})]})]})]})},s.id))}),R.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing page ",J," of ",R.totalPages," (",R.total," total profiles)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{onClick:V,disabled:!Z||c,variant:"outline",size:"sm",children:"Previous"}),e.jsx(o,{onClick:K,disabled:!W||c,variant:"outline",size:"sm",children:"Next"})]})]})]})}),e.jsx(pe,{isOpen:r,onClose:()=>{a(!1),m(null)},onSubmit:re,profileName:i?A(i):"this profile"})]})})};export{Ee as default};
