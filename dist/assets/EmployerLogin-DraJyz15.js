import{c as F,b as P,r as o,j as e,w as O,g as R,p as _,E as T,e as q,L as v}from"./vendor-react-BkwhrffK.js";import{u as B,B as U}from"./index-CfgR3oxw.js";import{m as l}from"./vendor-motion-CuEGWhdi.js";import"./vendor-common-BZD0eUgH.js";import"./vendor-gsap-lnFyu4_T.js";const H=()=>{const{t:V}=F(),N=P(),{login:S,loading:a,error:x,user:r,isAuthenticated:i,sessionValid:n}=B(),[d,L]=o.useState({email:"",password:""}),[b,E]=o.useState(!1),[y,g]=o.useState(!1),[m,u]=o.useState(""),[f,h]=o.useState({}),[k,I]=o.useState(!1),[j,p]=o.useState(!1);o.useEffect(()=>{console.log("🔍 EmployerLogin: Page loaded/rendered");const c=history.pushState,s=history.replaceState;return history.pushState=function(...t){if(j){console.log("🔒 BLOCKED pushState during login:",t);return}return c.apply(this,t)},history.replaceState=function(...t){if(j){console.log("🔒 BLOCKED replaceState during login:",t);return}return s.apply(this,t)},()=>{console.log("🔍 EmployerLogin: Page unmounting"),history.pushState=c,history.replaceState=s}},[j]),console.log("🔍 EmployerLogin Debug:",{user:r,isAuthenticated:i,sessionValid:n,authLoading:a,authError:x}),o.useEffect(()=>{h({user:r,isAuthenticated:i,sessionValid:n,authLoading:a,authError:x,timestamp:new Date().toISOString()})},[r,i,n,a,x]);const w=c=>{const{name:s,value:t}=c.target;L(A=>({...A,[s]:t})),m&&u("")},C=async c=>{c.preventDefault(),console.log("🔍 Form submission started");try{p(!0),g(!0),u(""),I(!0),console.log("🔍 Attempting employer login with:",d),g(!0);const s=await S(d.email,d.password,"employer");console.log("🔍 Login result:",s),g(!1),s.success?(console.log("✅ Employer login successful:",s.user),u(""),h(t=>({...t,loginResult:s,loginSuccess:!0,message:"Login successful! Redirecting to dashboard..."})),setTimeout(()=>{console.log("🔍 Allowing navigation to dashboard"),p(!1),N("/dashboard/employer")},1500)):(console.log("❌ Login failed, staying on page"),console.error("❌ Employer login failed:",s.error),u(s.error||"Login failed. Please try again."),h(t=>({...t,loginResult:s,loginSuccess:!1,error:s.error,message:"Login failed. Please check your credentials and try again."})),localStorage.removeItem("employer_user"),localStorage.removeItem("job_portal_token"),p(!1))}catch(s){console.log("❌ Login error caught, staying on page"),console.error("❌ Login error:",s),u("Network error. Please check your connection and try again."),h(t=>({...t,loginError:s,error:"Network error"})),p(!1)}finally{console.log("🔍 Login process completed"),g(!1)}},D=()=>{E(!b)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4",children:e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(l.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"w-16 h-16 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(O,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Employer Login"}),e.jsx("p",{className:"text-gray-600",children:"Access your employer dashboard to manage requests and payments"})]}),m&&e.jsx(l.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:m}),f.loginSuccess&&e.jsx(l.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm",children:f.message}),y&&e.jsx(l.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg text-sm text-center",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Logging in..."]})}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(R,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"email",id:"email",name:"email",value:d.email,onChange:w,required:!0,className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your email"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:b?"text":"password",id:"password",name:"password",value:d.password,onChange:w,required:!0,className:"block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your password"}),e.jsx("button",{type:"button",onClick:D,className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:b?e.jsx(T,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"}):e.jsx(q,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})]}),m&&e.jsx(l.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-600",children:m})}),e.jsx(U,{type:"submit",disabled:y||a,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:y||a?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Logging in..."]}):"Login to Dashboard"})]}),e.jsxs("div",{className:"mt-6 text-center space-y-3",children:[e.jsx(v,{to:"/forgot-password",className:"text-sm text-blue-600 hover:text-blue-800 transition-colors",children:"Forgot your password?"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Don't have an employer account?"," ",e.jsx(v,{to:"/employer-request",className:"text-blue-600 hover:text-blue-800 font-medium transition-colors",children:"Submit a request"})]})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Need help?"," ",e.jsx(v,{to:"/contact",className:"text-blue-600 hover:text-blue-800 transition-colors",children:"Contact our support team"})]})}),k&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-100 rounded-lg shadow-md text-sm text-gray-800",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Login Debug Info:"}),e.jsx("pre",{className:"whitespace-pre-wrap break-words",children:JSON.stringify(f,null,2)})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2 text-blue-800",children:"🔍 Real-time Auth State:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"User:"})," ",r?"✅ Set":"❌ Not Set"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"isAuthenticated:"})," ",i?"✅ True":"❌ False"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"sessionValid:"})," ",n?"✅ True":"❌ False"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"authLoading:"})," ",a?"✅ True":"❌ False"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"User Role:"})," ",r?.role||"None"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"User ID:"})," ",r?.id||"None"]})]}),r&&e.jsxs("div",{className:"mt-2 p-2 bg-white rounded border",children:[e.jsx("strong",{children:"User Object:"}),e.jsx("pre",{className:"text-xs mt-1",children:JSON.stringify(r,null,2)})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("button",{onClick:()=>{console.log("🧪 Current auth state before navigation:",{user:r,isAuthenticated:i,sessionValid:n,authLoading:a}),N("/dashboard/employer")},className:"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"🧪 Test Navigation to Dashboard"}),e.jsx("button",{onClick:()=>{console.log("🧪 Force navigation with current state:",{user:r,isAuthenticated:i,sessionValid:n}),window.location.href="/dashboard/employer"},className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 ml-2",children:"🧪 Force Navigation (window.location)"}),e.jsx("button",{onClick:()=>{console.log("🧪 Check localStorage:",{employer_user:localStorage.getItem("employer_user"),token:localStorage.getItem("job_portal_token")})},className:"px-3 py-1 bg-purple-600 text-white text-xs rounded hover:bg-purple-700 ml-2",children:"🧪 Check localStorage"})]})]})]})})};export{H as default};
