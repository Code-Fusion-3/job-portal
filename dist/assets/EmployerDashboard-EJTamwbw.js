import{r as d,j as e,aa as ne,a2 as se,bf as he,t as Y,bg as te,aC as pe,Q as ae,C as D,a0 as ke,c as S,af as W,bh as Ee,aL as ue,bi as Le,ah as F,ac as $,ad as be,aJ as re,m as ge,V as Te,Y as Me,aD as Fe,aN as T}from"./vendor-react-Ciyz3SKt.js";import{A as w,b as z,u as $e}from"./index-r2M3Ub8S.js";import{M as ye}from"./Modal-C6o3KIs2.js";import{E as M}from"./endpoints-CXiMw_A_.js";import{m as fe}from"./messagingService-DyTZ4vg8.js";const Ue=({isOpen:Q,onClose:c,selectedRequest:a,messages:y,newMessage:k,setNewMessage:r,sendMessage:f,messagingLoading:U,paymentHistory:g,loadingPaymentHistory:K,getStatusColor:V,getPriorityColor:_,getProgressColor:J,getProgressPercentage:b})=>{const[I,P]=d.useState(!1);if(!a)return null;const B=(s,l)=>{if(!s)return"Unknown";console.log("ðŸ” Payment Status Debug:",{paymentType:s.paymentType,paymentStatus:s.status,requestStatus:l,paymentId:s.id});const h=(s.paymentType==="photo_access"||s.paymentType==="photo"||!s.paymentType&&["photo_access_granted","second_payment_required","second_payment_confirmed","full_access_granted","completed"].includes(l))&&["photo_access_granted","second_payment_required","second_payment_confirmed","full_access_granted","completed"].includes(l),u=(s.paymentType==="full_details"||s.paymentType==="full"||!s.paymentType&&["full_access_granted","completed"].includes(l))&&["full_access_granted","completed"].includes(l);if(console.log("ðŸ” Approval Check:",{isPhotoPaymentApproved:h,isFullPaymentApproved:u,finalResult:h||u?"Approved by Admin":"Not approved"}),h||u)return"Approved by Admin";switch(s.status){case"confirmed":return"Confirmed - Pending Admin Approval";case"approved":return"Approved by Admin";case"completed":return"Completed";case"pending":return"Pending Payment";case"rejected":return"Rejected";case"failed":return"Failed";default:return s.status?s.status.charAt(0).toUpperCase()+s.status.slice(1):"Unknown"}},X=(s,l)=>{if(!s)return"bg-gray-100 text-gray-800";const h=(s.paymentType==="photo_access"||s.paymentType==="photo"||!s.paymentType&&["photo_access_granted","second_payment_required","second_payment_confirmed","full_access_granted","completed"].includes(l))&&["photo_access_granted","second_payment_required","second_payment_confirmed","full_access_granted","completed"].includes(l),u=(s.paymentType==="full_details"||s.paymentType==="full"||!s.paymentType&&["full_access_granted","completed"].includes(l))&&["full_access_granted","completed"].includes(l);if(h||u)return"bg-green-100 text-green-800";switch(s.status){case"confirmed":return"bg-blue-100 text-blue-800";case"approved":case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},O=()=>{const s=a.status;switch(console.log("ðŸŽ¯ Access Control Debug:",{requestStatus:s,selectedRequest:a}),s){case"pending":case"approved":case"first_payment_required":case"second_payment_required":return e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Payment Required"]});case"first_payment_confirmed":case"second_payment_confirmed":case"payment_confirmed":return e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Paid - Pending Approval"]});case"photo_access_granted":return e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Photo Access Approved"]});case"full_access_granted":case"completed":return e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Fully Paid & Approved"]});default:return e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Payment Required"]})}},E=()=>{switch(a.status){case"photo_access_granted":case"full_access_granted":case"completed":return"bg-green-100 text-green-800";case"first_payment_confirmed":case"second_payment_confirmed":case"payment_confirmed":return"bg-blue-100 text-blue-800";default:return"bg-orange-100 text-orange-800"}},j=()=>{const s=a.status,l=a.imageAccessGranted||a.candidate?.accessGranted?.photo,h=a.contactAccessGranted||a.candidate?.accessGranted?.contact,u=a.candidate?.accessGranted?.full||l&&h,o=["first_payment_confirmed","photo_access_granted","second_payment_confirmed","full_details_granted","payment_confirmed","completed"],m=["photo_access_granted","second_payment_confirmed","full_details_granted","completed"],A=o.includes(s),L=l||m.includes(s)||a.candidate?.accessLevel==="photo"||a.candidate?.accessLevel==="full";return{canViewPhoto:L,canViewContact:h||["full_details_granted","completed"].includes(s)||a.candidate?.accessLevel==="full",canDownloadPhoto:L&&A,hasFullAccess:u,isPaid:A,status:s}},N=async(s,l)=>{if(s)try{const u=await(await fetch(s)).blob(),o=window.URL.createObjectURL(u),m=document.createElement("a");m.href=o,m.download=`${l.replace(/\s+/g,"_")}_photo.jpg`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(o)}catch(h){console.error("Error downloading image:",h),alert("Failed to download image. Please try again.")}},n=j();return e.jsxs(ye,{isOpen:Q,onClose:c,title:`Request Details - #${a.id}`,maxWidth:"max-w-6xl",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ne,{className:"h-5 w-5 mr-2 text-blue-600"}),"Request Information"]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${V(a.status)}`,children:a.status?a.status.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase()):"Unknown"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Priority"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${_(a.priority)}`,children:a.priority?a.priority.charAt(0).toUpperCase()+a.priority.slice(1):"Unknown"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Created"}),e.jsx("p",{className:"text-gray-900",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Progress"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${J(b(a))}`,style:{width:`${b(a)}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[b(a),"%"]})]})]})]})})]}),a.candidate&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(se,{className:"h-5 w-5 mr-2 text-blue-600"}),"Candidate Information",e.jsxs("div",{className:"ml-auto flex items-center space-x-2",children:[n.hasFullAccess&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"Full Access"]}),n.canViewPhoto&&!n.hasFullAccess&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Photo Access"]}),!n.canViewPhoto&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"No Access"]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4 pb-4 border-b border-gray-200",children:[n.canViewPhoto?a.candidate.photo?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:(()=>{const s=a.candidate.photo;if(!s)return"/api/placeholder/64/64";if(s.startsWith("http"))return s;const l=s.replace(/^\/+/,"");return`${w.BASE_URL}/${l}`})(),alt:a.candidate.name,className:"w-16 h-16 rounded-full object-cover border-2 border-gray-200 cursor-pointer hover:ring-2 hover:ring-blue-300 transition-all",onError:s=>{s.target.src="/api/placeholder/64/64"},onClick:()=>P(!0)}),n.canDownloadPhoto&&e.jsx("button",{onClick:()=>{const s=a.candidate.photo,l=s.startsWith("http")?s:`${w.BASE_URL}/${s.replace(/^\/+/,"")}`;N(l,a.candidate.name)},className:"absolute -top-1 -right-1 p-1 bg-blue-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-blue-700",title:"Download Image",children:e.jsx(pe,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center border-2 border-gray-300 relative",children:[e.jsx(se,{className:"h-8 w-8 text-gray-500"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 p-1 bg-green-500 text-white rounded-full",children:e.jsx(Y,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"w-16 h-16 rounded-full bg-gray-300 flex items-center justify-center relative",children:[e.jsx(ae,{className:"h-6 w-6 text-gray-500"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 p-1 bg-red-500 text-white rounded-full",children:e.jsx(te,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"text-lg font-semibold text-gray-900",children:a.candidate.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.candidate.skills}),e.jsx("p",{className:"text-sm font-medium text-green-600",children:a.candidate.monthlyRate}),!n.canViewPhoto&&e.jsxs("div",{className:"mt-2 flex items-center text-xs text-orange-600",children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Photo access requires payment approval"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Experience"}),e.jsx("p",{className:"text-gray-900",children:a.candidate.experience})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Location"}),e.jsx("p",{className:"text-gray-900",children:typeof a.candidate.location=="object"?`${a.candidate.location.city||""}, ${a.candidate.location.country||""}`.replace(/^,\s*|,\s*$/g,""):a.candidate.location||"Not specified"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-500 flex items-center",children:["Contact",!n.canViewContact&&e.jsx(ae,{className:"h-3 w-3 ml-1 text-red-500"})]}),e.jsx("p",{className:"text-gray-900",children:n.canViewContact?a.candidate.contactNumber||"Not provided":"***-***-***"}),!n.canViewContact&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Requires full details access"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-500 flex items-center",children:["Email",!n.canViewContact&&e.jsx(ae,{className:"h-3 w-3 ml-1 text-red-500"})]}),e.jsx("p",{className:"text-gray-900",children:n.canViewContact?a.candidate.email||"Not provided":"***@***.***"}),!n.canViewContact&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Requires full details access"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Education Level"}),e.jsx("p",{className:"text-gray-900",children:a.candidate.educationLevel})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Experience Level"}),e.jsx("p",{className:"text-gray-900",children:a.candidate.experienceLevel})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Availability"}),e.jsx("p",{className:"text-gray-900",children:a.candidate.availability})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Languages"}),e.jsx("p",{className:"text-gray-900",children:a.candidate.languages})]})]}),a.candidate.description&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-900 text-sm leading-relaxed",children:a.candidate.description})]}),a.candidate.certifications&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-2",children:"Certifications"}),e.jsx("p",{className:"text-gray-900 text-sm",children:a.candidate.certifications})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Access Control & Status"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Photo Access"})]}),e.jsxs("div",{className:"flex items-center",children:[n.canViewPhoto?e.jsx(S,{className:"h-4 w-4 text-green-500 mr-1"}):e.jsx(W,{className:"h-4 w-4 text-orange-500 mr-1"}),e.jsx("span",{className:`text-xs font-medium ${n.canViewPhoto?"text-green-600":"text-orange-600"}`,children:n.canViewPhoto?"Granted":"Pending"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-2 text-purple-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Contact Access"})]}),e.jsxs("div",{className:"flex items-center",children:[n.canViewContact?e.jsx(S,{className:"h-4 w-4 text-green-500 mr-1"}):e.jsx(W,{className:"h-4 w-4 text-orange-500 mr-1"}),e.jsx("span",{className:`text-xs font-medium ${n.canViewContact?"text-green-600":"text-orange-600"}`,children:n.canViewContact?"Granted":"Pending"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Current Access Level"})]}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${n.hasFullAccess?"bg-green-100 text-green-800":n.canViewPhoto?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:n.hasFullAccess?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"Full Access"]}):n.canViewPhoto?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Photo Only"]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"No Access"]})})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(ue,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Payment Status"})]}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${E()}`,children:O()})]})]})]}),!n.canViewPhoto&&e.jsx("div",{className:"mt-4 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(D,{className:"h-5 w-5 text-orange-500 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-sm font-medium text-orange-800",children:"Photo Access Required"}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"Complete the first payment to unlock candidate photo and basic information."})]})]})}),n.canViewPhoto&&!n.canViewContact&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(D,{className:"h-5 w-5 text-blue-500 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-sm font-medium text-blue-800",children:"Full Details Access Available"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Complete the second payment to unlock contact information and full candidate details."})]})]})}),n.hasFullAccess&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(S,{className:"h-5 w-5 text-green-500 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-sm font-medium text-green-800",children:"Full Access Granted"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"You have complete access to all candidate information including contact details."})]})]})})]})]})]}),a.paymentRequired&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Le,{className:"h-5 w-5 mr-2 text-blue-600"}),"Payment History"]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Amount Required"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:[a.paymentAmount," ",a.paymentCurrency]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Due Date"}),e.jsx("p",{className:"text-gray-900",children:a.paymentDueDate?new Date(a.paymentDueDate).toLocaleDateString():"Not specified"})]}),a.paymentDescription&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"text-gray-900",children:a.paymentDescription})]})]}),K?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(F,{className:"animate-spin h-6 w-6 text-blue-500 mx-auto"}),e.jsx("p",{className:"text-gray-600",children:"Loading payment history..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ue,{className:"h-10 w-10 text-gray-400 mx-auto"}),e.jsx("p",{className:"text-gray-600",children:"No payments made yet for this request."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-700",children:"All Payments"}),g.map((s,l)=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Amount"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:s.payment?.amount&&s.payment?.currency?`${s.payment.amount} ${s.payment.currency}`:"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${X(s.payment,a.status)}`,children:B(s.payment,a.status)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.payment?.createdAt?new Date(s.payment.createdAt).toLocaleDateString():"Not specified"})]})]}),(s.payment?.paymentType||s.payment?.paymentMethod)&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.payment?.paymentType&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Payment Type:"}),e.jsx("span",{className:"ml-2 text-gray-900 capitalize",children:s.payment.paymentType==="photo_access"?"Photo Access":s.payment.paymentType==="full_details"?"Full Details Access":s.payment.paymentType})]}),s.payment?.paymentMethod&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Payment Method:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:s.payment.paymentMethod})]})]})}),s.payment?.confirmationName&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[e.jsx("h6",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Payment Confirmation Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Confirmed by:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:s.payment.confirmationName})]}),s.payment?.confirmationPhone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Phone:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:s.payment.confirmationPhone})]}),s.payment?.confirmationReference&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Reference:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:s.payment.confirmationReference})]}),s.payment?.confirmationDate&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Confirmed on:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:new Date(s.payment.confirmationDate).toLocaleDateString()})]})]})]}),s.payment?.status==="confirmed"&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Waiting for Admin Approval"}),e.jsx("p",{className:"mt-1 text-sm text-blue-700",children:"Your payment has been confirmed and is now waiting for admin approval. If this takes longer than expected, please message the admin or call for assistance."})]})]})})})]},s.id||l))]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx($,{className:"h-5 w-5 mr-2 text-blue-600"}),"Messages"]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[U?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(F,{className:"animate-spin h-6 w-6 text-blue-500 mx-auto"}),e.jsx("p",{className:"text-gray-600",children:"Loading messages..."})]}):y.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx($,{className:"h-10 w-10 text-gray-400 mx-auto"}),e.jsx("p",{className:"text-gray-600",children:"No messages yet for this request."})]}):e.jsx("div",{className:"space-y-4 max-h-60 overflow-y-auto",children:y.map(s=>e.jsx("div",{className:`flex ${s.fromAdmin?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${s.fromAdmin?"bg-white text-gray-900 border border-gray-200":"bg-blue-600 text-white"}`,children:[e.jsx("div",{className:"text-sm",children:s.content}),e.jsx("div",{className:`text-xs mt-1 ${s.fromAdmin?"text-gray-500":"text-blue-100"}`,children:new Date(s.createdAt).toLocaleString()})]})},s.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:k,onChange:s=>r(s.target.value),placeholder:"Type your message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:s=>s.key==="Enter"&&f()}),e.jsxs("button",{onClick:f,disabled:!k.trim()||U,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{children:"Send"})]})]})})]})]})]}),I&&n.canViewPhoto&&a.candidate.photo&&e.jsx(ye,{isOpen:I,onClose:()=>P(!1),title:`${a.candidate.name} - Profile Photo`,maxWidth:"max-w-3xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:(()=>{const s=a.candidate.photo;return s?s.startsWith("http")?s:`${w.BASE_URL}/${s.replace(/^\/+/,"")}`:"/api/placeholder/400/400"})(),alt:a.candidate.name,className:"w-full max-h-96 object-contain rounded-lg",onError:s=>{s.target.src="/api/placeholder/400/400"}}),n.canDownloadPhoto&&e.jsxs("button",{onClick:()=>{const s=a.candidate.photo,l=s.startsWith("http")?s:`${w.BASE_URL}/${s.replace(/^\/+/,"")}`;N(l,a.candidate.name)},className:"absolute bottom-4 right-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 shadow-lg transition-colors",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:"Download"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900",children:a.candidate.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.candidate.skills})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:a.candidate.monthlyRate}),e.jsx("p",{className:"text-xs text-gray-500",children:"Monthly Rate"})]})]}),!n.canDownloadPhoto&&e.jsx("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-4 w-4 text-orange-500 mr-2"}),e.jsx("span",{className:"text-sm text-orange-700",children:"Download requires payment approval"})]})})]})})]})};class Ve{async getDashboardData(){try{console.log("ðŸ” employerDashboardService.getDashboardData called"),console.log("ðŸ” API endpoint:",M.EMPLOYER.DASHBOARD),console.log("ðŸ” Auth token:",localStorage.getItem("job_portal_token"));const c=await z.get(M.EMPLOYER.DASHBOARD);return console.log("âœ… API response:",c),c}catch(c){throw console.error("âŒ employerDashboardService.getDashboardData error:",c),console.error("âŒ Error response:",c.response),c}}async getRequestDetails(c){try{return(await z.get(M.EMPLOYER.GET_REQUEST_BY_ID(c))).data}catch(a){throw console.error("Error getting request details:",a),a}}async updateRequestStatus(c,a){try{return(await z.put(M.EMPLOYER.GET_REQUEST_BY_ID(c),{status:a})).data}catch(y){throw console.error("Error updating request status:",y),y}}async getRequestStats(){try{return(await z.get(M.EMPLOYER.GET_REQUESTS+"/stats")).data}catch(c){throw console.error("Error getting request stats:",c),c}}}const Ie=new Ve,Ye=()=>{const{user:Q}=$e(),[c,a]=d.useState(null),[y,k]=d.useState(!0),[r,f]=d.useState(null),[U,g]=d.useState([]),[K,V]=d.useState(!1),[_,J]=d.useState("all"),[b,I]=d.useState(""),[P,B]=d.useState(!1),[X,O]=d.useState(!1),[E,j]=d.useState([]),[N,n]=d.useState(""),[s,l]=d.useState(!1),[h,u]=d.useState(!1),[o,m]=d.useState({confirmationName:"",confirmationPhone:"",paymentReference:"",transferAmount:"",transferDate:"",notes:""}),[A,L]=d.useState(!1),[le,C]=d.useState(""),[ce,Z]=d.useState(""),R=async()=>{try{k(!0);const t=await Ie.getDashboardData();a(t)}catch(t){console.error("âŒ Error fetching dashboard data:",t),console.error("âŒ Error details:",{message:t.message,status:t.response?.status,statusText:t.response?.statusText,data:t.response?.data}),T.error("Failed to load dashboard data")}finally{k(!1)}},G=async t=>{l(!0);try{const i=localStorage.getItem("job_portal_token");if(console.log("Token found:",!!i,i?"exists":"missing"),!i){console.error("No authentication token found"),j([]);return}const p=await fetch(`${w.BASE_URL}/messaging/request/${t}`,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});if(console.log("Response status:",p.status),p.ok){const v=await p.json();j(v.messages||[])}else console.error("Failed to fetch messages, status:",p.status),j([])}catch(i){console.error("Error fetching messages:",i),j([])}finally{l(!1)}},je=async t=>{V(!0);try{const i=localStorage.getItem("job_portal_token"),p=await fetch(`${w.BASE_URL}/payments/details/${t}`,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});if(p.ok){const v=await p.json();if(v.payments&&Array.isArray(v.payments)){const Se=v.payments.map(x=>({id:x.id,payment:{id:x.id,amount:x.amount,currency:x.currency,paymentMethod:x.paymentMethod,paymentType:x.paymentType,status:x.status,description:x.description,createdAt:x.createdAt,updatedAt:x.updatedAt,confirmationName:x.confirmationName,confirmationPhone:x.confirmationPhone,confirmationDate:x.confirmationDate,confirmationReference:x.confirmationReference,adminNotes:x.adminNotes}}));g(Se)}else g([])}else console.error("Failed to fetch payment history, using latestPayment if available"),console.log("selectedRequest:",r),console.log("latestPayment:",r?.latestPayment),r?.latestPayment?(console.log("Setting paymentHistory with latestPayment:",r.latestPayment),g([r.latestPayment])):(console.log("No latestPayment found, setting empty array"),g([]))}catch(i){console.error("Error fetching payment history:",i),console.log("selectedRequest in catch:",r),console.log("latestPayment in catch:",r?.latestPayment),r?.latestPayment?(console.log("Setting paymentHistory with latestPayment in catch:",r.latestPayment),g([r.latestPayment])):(console.log("No latestPayment found in catch, setting empty array"),g([]))}finally{V(!1)}},q=async()=>{if(!(!N.trim()||!r))try{l(!0),await fe.sendMessage(r.id,{content:N.trim(),messageType:"text"}),n(""),await G(r.id),T.success("Message sent successfully")}catch(t){console.error("Error sending message:",t),T.error("Failed to send message")}finally{l(!1)}},Ne=async t=>{f(t),B(!0),await G(t.id)},ie=()=>{B(!1),f(null),j([]),n("")},ve=()=>{O(!1),f(null),j([]),n(""),g([])},we=(t,i)=>{t.target===t.currentTarget&&ie()},_e=async()=>{if(r)try{await fe.markMessagesAsRead(r.id),await G(r.id)}catch(t){console.error("Error marking messages as read:",t)}},Pe=t=>{f(t),O(!0),G(t.id),je(t.id)};d.useEffect(()=>{R()},[]),d.useEffect(()=>{P&&r&&_e()},[P,r]);const Ae=t=>{f(t),u(!0),m({confirmationName:"",confirmationPhone:"",paymentReference:"",transferAmount:"",transferDate:"",notes:""}),C(""),Z("")},H=()=>{u(!1),m({confirmationName:"",confirmationPhone:"",paymentReference:"",transferAmount:"",transferDate:"",notes:""}),C(""),Z("")},Ce=async t=>{if(t.preventDefault(),!o.confirmationName||!o.confirmationPhone){C("Please provide your name and phone number");return}try{L(!0),C("");const i=await fetch(`${w.BASE_URL}/payment-confirmations/confirm`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem(w.AUTH_CONFIG.tokenKey)}`},body:JSON.stringify({paymentId:r.latestPayment?.id,confirmationName:o.confirmationName,confirmationPhone:o.confirmationPhone,paymentReference:o.paymentReference,transferAmount:r.paymentAmount,transferDate:o.transferDate,notes:o.notes})}),p=await i.json();if(i.ok)T.success("Payment confirmation submitted successfully!"),H(),R(),m({confirmationName:"",confirmationPhone:"",paymentReference:"",transferAmount:"",transferDate:"",notes:""}),Z("Payment confirmation submitted successfully!");else{const v=p.error||"Failed to submit payment confirmation";C(v),T.error(v)}}catch(i){console.error("Error submitting payment confirmation:",i),C("Network error. Please try again.")}finally{L(!1)}},ee=c?.requests?.filter(t=>{const i=_==="all"||t.status===_,p=t.candidate?.name?.toLowerCase().includes(b.toLowerCase())||t.candidate?.skills?.toLowerCase().includes(b.toLowerCase());return i&&p})||[],oe=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"reviewing":return"bg-blue-100 text-blue-800 border-blue-200";case"payment_required":return"bg-orange-100 text-orange-800 border-orange-200";case"payment_confirmed":return"bg-purple-100 text-purple-800 border-purple-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"completed":return"bg-gray-100 text-gray-800 border-gray-200";case"first_payment_required":return"bg-orange-100 text-orange-800 border-orange-200";case"first_payment_confirmed":return"bg-purple-100 text-purple-800 border-purple-200";case"photo_access_granted":return"bg-blue-100 text-blue-800 border-blue-200";case"full_details_requested":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"second_payment_required":return"bg-orange-100 text-orange-800 border-orange-200";case"second_payment_confirmed":return"bg-purple-100 text-purple-800 border-purple-200";case"full_access_granted":return"bg-green-100 text-green-800 border-green-200";case"hiring_decision_made":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},de=t=>{switch(t){case"urgent":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"normal":return"bg-blue-100 text-blue-800 border-blue-200";case"low":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},me=t=>{switch(t.status){case"pending":return 10;case"reviewing":return 20;case"approved":return 30;case"first_payment_required":return 40;case"first_payment_confirmed":return 50;case"photo_access_granted":return 60;case"full_details_requested":return 65;case"second_payment_required":return 70;case"second_payment_confirmed":return 80;case"full_access_granted":return 90;case"hiring_decision_made":return 95;case"completed":return 100;case"payment_required":return 60;case"payment_confirmed":return 80;default:return 0}},xe=t=>t>=80?"bg-green-500":t>=60?"bg-blue-500":t>=40?"bg-yellow-500":"bg-red-500";if(y)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"animate-spin h-12 w-12 text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading your dashboard..."})]})});if(!c)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load dashboard data"}),e.jsx("button",{onClick:R,className:"mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Try Again"})]})});const De=[{title:"Total Requests",value:c.stats.totalRequests,icon:ne,color:"bg-blue-500"},{title:"Pending Payments",value:c.stats.paymentRequired,icon:re,color:"bg-yellow-500"},{title:"Approved Requests",value:c.stats.approvedRequests,icon:S,color:"bg-green-500"},{title:"Unread Messages",value:c.stats.unreadMessages,icon:$,color:"bg-purple-500"}];return e.jsxs("div",{className:"min-h-screen bg-gray-50 relative",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Employer Dashboard"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Welcome back, ",c.employer?.name||"Employer","! Manage your job seeker requests and payments"]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("button",{onClick:R,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{children:"Refresh"})]})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:De.map((t,i)=>e.jsx(ge.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.1},className:"bg-white rounded-xl shadow-sm border p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:t.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:t.value})]}),e.jsx("div",{className:`${t.color} p-3 rounded-lg`,children:e.jsx(t.icon,{className:"h-6 w-6 text-white"})})]})},t.title))}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search candidates or skills...",value:b,onChange:t=>I(t.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:_,onChange:t=>J(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewing",children:"Reviewing"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"first_payment_required",children:"First Payment Required"}),e.jsx("option",{value:"first_payment_confirmed",children:"First Payment Confirmed"}),e.jsx("option",{value:"photo_access_granted",children:"Photo Access Granted"}),e.jsx("option",{value:"full_details_requested",children:"Full Details Requested"}),e.jsx("option",{value:"second_payment_required",children:"Second Payment Required"}),e.jsx("option",{value:"second_payment_confirmed",children:"Second Payment Confirmed"}),e.jsx("option",{value:"full_access_granted",children:"Full Access Granted"}),e.jsx("option",{value:"hiring_decision_made",children:"Hiring Decision Made"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"payment_required",children:"Payment Required (Legacy)"}),e.jsx("option",{value:"payment_confirmed",children:"Payment Confirmed (Legacy)"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsxs("span",{children:[ee.length," of ",c.stats.totalRequests," requests"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Your Requests"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Candidate"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Skills & Experience"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Priority"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ee.map(t=>{const i=me(t);return e.jsxs(ge.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.candidate?.name||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Requested ",new Date(t.createdAt).toLocaleDateString()]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.candidate?.skills||"Not specified"}),e.jsx("div",{className:"text-sm text-gray-500",children:t.candidate?.experienceLevel||"Not specified"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${oe(t.status)}`,children:t.status.replace("_"," ").replace(/\b\w/g,p=>p.toUpperCase())})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${de(t.priority)}`,children:t.priority.charAt(0).toUpperCase()+t.priority.slice(1)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${xe(i)}`,style:{width:`${i}%`}})}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i,"%"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>Ne(t),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md text-xs transition-colors flex items-center space-x-1",children:[e.jsx($,{className:"h-3 w-3"}),e.jsx("span",{children:"Message"})]}),e.jsx("button",{onClick:()=>Pe(t),className:"text-blue-600 hover:text-blue-900 text-xs",children:"View Details"}),(t.status==="payment_required"||t.status==="first_payment_required"||t.status==="second_payment_required")&&t.paymentRequired&&e.jsxs("button",{onClick:()=>Ae(t),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-xs transition-colors flex items-center space-x-1",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsx("span",{children:"Confirm Payment"})]})]})})]},t.id)})})]})})]}),ee.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ne,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No requests found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:b||_!=="all"?"Try adjusting your search or filters.":"Get started by submitting your first job seeker request."})]})]}),P&&r&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center z-40 p-4",onClick:t=>we(t),children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-20"}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50 rounded-t-xl",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Messages - Request #",r.id]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.candidate?.name||"N/A"," â€¢ ",r.status]})]}),e.jsxs("button",{onClick:ie,className:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50",children:s?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"animate-spin h-8 w-8 text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading messages..."})]}):E.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Start the conversation!"})]}):E.map(t=>e.jsx("div",{className:`flex ${t.fromAdmin?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg shadow-sm ${t.fromAdmin?"bg-white text-gray-900 border border-gray-200":"bg-blue-600 text-white"}`,children:[e.jsx("div",{className:"text-sm",children:t.content}),e.jsx("div",{className:`text-xs mt-1 ${t.fromAdmin?"text-gray-500":"text-blue-100"}`,children:new Date(t.createdAt).toLocaleString()})]})},t.id))}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-white rounded-b-xl",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:N,onChange:t=>n(t.target.value),placeholder:"Type your message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:t=>t.key==="Enter"&&q()}),e.jsxs("button",{onClick:q,disabled:!N.trim()||s,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{children:"Send"})]})]})})]})]}),e.jsx(Ue,{isOpen:X&&r,onClose:ve,selectedRequest:r,messages:E,newMessage:N,setNewMessage:n,sendMessage:q,messagingLoading:s,paymentHistory:U,loadingPaymentHistory:K,getStatusColor:oe,getPriorityColor:de,getProgressColor:xe,getProgressPercentage:me}),h&&r&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center z-40 p-4",onClick:t=>t.target===t.currentTarget&&H(),children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-20"}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-2xl w-full max-w-2xl flex flex-col border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50 rounded-t-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Confirm Payment - Request #",r.id]}),e.jsxs("button",{onClick:H,className:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),e.jsx("div",{className:"flex-1 p-6 bg-gray-50",children:e.jsxs("form",{onSubmit:Ce,className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"Payment Details:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Amount:"}),e.jsxs("span",{className:"text-blue-900 font-semibold",children:[r.paymentAmount," ",r.paymentCurrency]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Description:"}),e.jsx("span",{className:"text-blue-900",children:r.paymentDescription||"Payment for candidate access"})]}),r.latestPayment?.paymentMethod&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Payment Method:"}),e.jsx("span",{className:"text-blue-900",children:r.latestPayment.paymentMethod.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Account Name:"}),e.jsx("span",{className:"text-blue-900",children:r.latestPayment.paymentMethod.accountName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Account Number:"}),e.jsx("span",{className:"text-blue-900 font-mono",children:r.latestPayment.paymentMethod.accountNumber})]}),r.latestPayment.paymentMethod.bankName&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Bank:"}),e.jsx("span",{className:"text-blue-900",children:r.latestPayment.paymentMethod.bankName})]})]}),!r.latestPayment?.paymentMethod&&e.jsx("div",{className:"text-amber-700 text-xs bg-amber-50 p-2 rounded border border-amber-200",children:"âš ï¸ Payment method details not available. Please contact admin for payment instructions."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Your Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o.confirmationName,onChange:t=>m({...o,confirmationName:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"As shown on transfer",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",value:o.confirmationPhone,onChange:t=>m({...o,confirmationPhone:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+250123456789",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Reference"}),e.jsx("input",{type:"text",value:o.paymentReference,onChange:t=>m({...o,paymentReference:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"MTN123456 or transfer ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Amount (Admin Requested)"}),e.jsx("input",{type:"number",value:r.paymentAmount||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 cursor-not-allowed",placeholder:"5000",min:"0",step:"100",readOnly:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This amount cannot be changed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Date"}),e.jsx("input",{type:"date",value:o.transferDate,onChange:t=>m({...o,transferDate:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",max:new Date().toISOString().split("T")[0]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{value:o.notes,onChange:t=>m({...o,notes:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",placeholder:"Any additional information about your payment..."})]}),le&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg border border-red-200",children:le}),ce&&e.jsx("div",{className:"text-sm text-green-600 bg-green-50 p-3 rounded-lg border border-green-200",children:ce}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:H,disabled:A,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:A,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg disabled:opacity-50 flex items-center space-x-2",children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:"Confirm Payment"})]})})]})]})})]})]}),e.jsx(Fe,{position:"top-right"})]})};export{Ye as default};
