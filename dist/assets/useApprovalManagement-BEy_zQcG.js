import{r as l}from"./vendor-react-7c9Xkq5J.js";import{v as O,p as T,l as $,i as x,j as v}from"./index-DolTLsE4.js";const G=(B={})=>{const{autoFetch:E=!1,initialPage:J=1,itemsPerPage:j=10}=B,[k,g]=l.useState([]),[S,b]=l.useState([]),[C,w]=l.useState([]),[y,f]=l.useState(!1),[A,c]=l.useState(null),[M,R]=l.useState(0),d=l.useRef(null),[n,m]=l.useState(J),[p,D]=l.useState({page:1,limit:j,total:0,totalPages:0}),P=l.useCallback((s,a,o)=>{console.error(`💥 ${a} error:`,s);let t=o||"An unexpected error occurred";if(s?.response?.status)switch(s.response.status){case 401:t="Authentication failed. Please log in again.";break;case 403:t="You do not have permission to perform this action.";break;case 404:t="Resource not found.";break;case 429:t="Too many requests. Please try again later.";break;case 500:t="Server error. Please try again later.";break;default:t=s?.response?.data?.message||t}else s?.code==="NETWORK_ERROR"&&(t="Network error. Please check your connection and try again.");return t},[]),h=l.useCallback(async(s,a=3)=>{for(let o=0;o<=a;o++)try{return await s()}catch(t){if(o===a)throw t;const r=Math.pow(2,o)*1e3;await new Promise(e=>setTimeout(e,r)),R(e=>e+1)}},[]),u=l.useCallback(async(s,a=1,o=!0)=>{d.current&&d.current.abort(),d.current=new AbortController,f(!0),c(null);const t=async()=>{const r=await v.getProfilesByStatus(s,{page:a,limit:j,signal:d.current?.signal});if(r.success){const e=r.data||[],i=r.pagination||{};switch(s){case"pending":g(e);break;case"approved":b(e);break;case"rejected":w(e);break;default:console.warn(`Unknown status: ${s}`);break}return D(i),m(a),R(0),{success:!0,data:e,pagination:i}}else throw new Error(r.error||"Failed to fetch profiles")};try{return o?await h(t):await t()}catch(r){if(r.name==="AbortError")return console.log("Fetch operation was cancelled"),{success:!1,error:"Operation cancelled"};const e=P(r,"fetchProfilesByStatus",`Failed to fetch ${s} profiles`);return c(e),{success:!1,error:e}}finally{f(!1),d.current=null}},[j,P,h]),N=l.useCallback(async s=>{if(!O(s)){const r=T("approve profile","Invalid profile ID provided");return c(r),{success:!1,error:r}}if(y){const r="Another operation is in progress. Please wait.";return console.warn("🚫 approveProfile: Operation blocked - another operation in progress"),{success:!1,error:r}}f(!0),c(null),$("approve",{id:s},{hook:"useApprovalManagement"});const a=[...k],o=[...S],t=async()=>{const r=await v.approveJobSeeker(s);if(r.success)return r;throw new Error(r.error||"Failed to approve profile")};try{g(e=>e.filter(i=>x(i)!==s));const r=await h(t);r.data&&b(e=>[...e,r.data]);try{console.log("🔄 Refreshing data after successful approval..."),await u("pending",n,!1),console.log("✅ Pending profiles refreshed successfully")}catch(e){console.warn("⚠️ Failed to refresh pending profiles after approval:",e)}return console.log("✅ Profile approval completed successfully:",{profileId:s,result:r}),{success:!0,data:r.data,message:r.message||"Profile approved successfully"}}catch(r){console.error("❌ Profile approval failed, rolling back state:",r),g(a),b(o);const e=P(r,"approveProfile","Failed to approve profile");return c(e),{success:!1,error:e}}finally{f(!1)}},[k,S,u,n,h,P,y]),q=l.useCallback(async(s,a)=>{if(!O(s)){const e=T("reject profile","Invalid profile ID provided");return c(e),{success:!1,error:e}}if(!a||typeof a!="string"||a.trim().length<10){const e="A detailed rejection reason (minimum 10 characters) is required";return c(e),{success:!1,error:e}}if(y){const e="Another operation is in progress. Please wait.";return console.warn("🚫 rejectProfile: Operation blocked - another operation in progress"),{success:!1,error:e}}f(!0),c(null),$("reject",{id:s},{hook:"useApprovalManagement",reason:a.trim()});const o=[...k],t=[...C],r=async()=>{const e=await v.rejectJobSeeker(s,a.trim());if(e.success)return e;throw new Error(e.error||"Failed to reject profile")};try{g(i=>i.filter(F=>x(F)!==s));const e=await h(r);e.data&&w(i=>[...i,e.data]);try{console.log("🔄 Refreshing data after successful rejection..."),await u("pending",n,!1),console.log("✅ Pending profiles refreshed successfully")}catch(i){console.warn("⚠️ Failed to refresh pending profiles after rejection:",i)}return console.log("✅ Profile rejection completed successfully:",{profileId:s,reason:a.trim(),result:e}),{success:!0,data:e.data,message:e.message||"Profile rejected successfully"}}catch(e){console.error("❌ Profile rejection failed, rolling back state:",e),g(o),w(t);const i=P(e,"rejectProfile","Failed to reject profile");return c(i),{success:!1,error:i}}finally{f(!1)}},[k,C,u,n,h,P,y]),W=l.useCallback(async s=>{f(!0),c(null);try{const a=await Promise.all(s.map(r=>v.approveJobSeeker(r))),o=a.filter(r=>r.success),t=a.filter(r=>!r.success);if(t.length===0)return g(r=>r.filter(e=>!s.includes(e.id))),b(r=>[...r,...o.map(e=>e.data)]),await u("pending",n),{success:!0,message:`Successfully approved ${o.length} profiles`,count:o.length};{const r=`Failed to approve ${t.length} profiles`;return c(r),{success:!1,error:r,failed:t}}}catch(a){const o="An error occurred during bulk approval";return console.error("💥 Bulk approve error:",a),c(o),{success:!1,error:o}}finally{f(!1)}},[u,n]),I=l.useCallback(async(s,a)=>{f(!0),c(null);try{const o=await Promise.all(s.map(e=>v.rejectJobSeeker(e,a))),t=o.filter(e=>e.success),r=o.filter(e=>!e.success);if(r.length===0)return g(e=>e.filter(i=>!s.includes(i.id))),w(e=>[...e,...t.map(i=>i.data)]),await u("pending",n),{success:!0,message:`Successfully rejected ${t.length} profiles`,count:t.length};{const e=`Failed to reject ${r.length} profiles`;return c(e),{success:!1,error:e,failed:r}}}catch(o){const t="An error occurred during bulk rejection";return console.error("💥 Bulk reject error:",o),c(t),{success:!1,error:t}}finally{f(!1)}},[u,n]),K=l.useCallback(s=>{m(Math.max(1,Math.min(s,p.totalPages)))},[p.totalPages]),L=l.useCallback(()=>{n<p.totalPages&&m(n+1)},[n,p.totalPages]),U=l.useCallback(()=>{n>1&&m(n-1)},[n]);return l.useEffect(()=>{E&&u("pending",1)},[E,u]),l.useEffect(()=>{c(null)},[n]),l.useEffect(()=>()=>{d.current&&d.current.abort()},[]),{pendingProfiles:k,approvedProfiles:S,rejectedProfiles:C,loading:y,error:A,retryCount:M,currentPage:n,pagination:p,fetchProfilesByStatus:u,approveProfile:N,rejectProfile:q,bulkApprove:W,bulkReject:I,goToPage:K,nextPage:L,prevPage:U,setCurrentPage:m,hasNextPage:n<p.totalPages,hasPrevPage:n>1,totalItems:p.total,totalPages:p.totalPages,clearError:()=>c(null),hasError:!!A,isRetrying:M>0}};export{G as u};
