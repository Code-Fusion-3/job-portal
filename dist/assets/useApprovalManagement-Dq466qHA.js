import{r as o}from"./vendor-react-BksKsjF4.js";import{v as R,q as A,o as k,j as w}from"./index-BzccmGOD.js";const _=(F={})=>{const{autoFetch:S=!1,initialPage:T=1,itemsPerPage:j=10}=F,[O,g]=o.useState([]),[$,m]=o.useState([]),[x,v]=o.useState([]),[y,f]=o.useState(!1),[C,l]=o.useState(null),[E,M]=o.useState(0),d=o.useRef(null),[c,b]=o.useState(T),[p,B]=o.useState({page:1,limit:j,total:0,totalPages:0}),h=o.useCallback((a,n,s)=>{console.error(`💥 ${n} error:`,a);let e=s||"An unexpected error occurred";if(a?.response?.status)switch(a.response.status){case 401:e="Authentication failed. Please log in again.";break;case 403:e="You do not have permission to perform this action.";break;case 404:e="Resource not found.";break;case 429:e="Too many requests. Please try again later.";break;case 500:e="Server error. Please try again later.";break;default:e=a?.response?.data?.message||e}else a?.code==="NETWORK_ERROR"&&(e="Network error. Please check your connection and try again.");return e},[]),P=o.useCallback(async(a,n=3)=>{for(let s=0;s<=n;s++)try{return await a()}catch(e){if(s===n)throw e;const r=Math.pow(2,s)*1e3;await new Promise(t=>setTimeout(t,r)),M(t=>t+1)}},[]),u=o.useCallback(async(a,n=1,s=!0)=>{d.current&&d.current.abort(),d.current=new AbortController,f(!0),l(null);const e=async()=>{const r=await w.getProfilesByStatus(a,{page:n,limit:j,signal:d.current?.signal});if(r.success){const t=r.data||[],i=r.pagination||{};switch(a){case"pending":g(t);break;case"approved":m(t);break;case"rejected":v(t);break;default:console.warn(`Unknown status: ${a}`);break}return B(i),b(n),M(0),{success:!0,data:t,pagination:i}}else throw new Error(r.error||"Failed to fetch profiles")};try{return s?await P(e):await e()}catch(r){if(r.name==="AbortError")return{success:!1,error:"Operation cancelled"};const t=h(r,"fetchProfilesByStatus",`Failed to fetch ${a} profiles`);return l(t),{success:!1,error:t}}finally{f(!1),d.current=null}},[j,h,P]),J=o.useCallback(async a=>{if(!R(a)){const s=A("approve profile","Invalid profile ID provided");return l(s),{success:!1,error:s}}if(y){const s="Another operation is in progress. Please wait.";return console.warn("🚫 approveProfile: Operation blocked - another operation in progress"),{success:!1,error:s}}f(!0),l(null);const n=async()=>{const s=await w.approveJobSeeker(a);if(s.success)return s;throw new Error(s.error||"Failed to approve profile")};try{g(e=>e.filter(r=>k(r)!==a));const s=await P(n);s.data&&m(e=>[...e,s.data]);try{await u("pending",c,!1)}catch(e){console.warn("⚠️ Failed to refresh pending profiles after approval:",e)}}catch(s){console.error("❌ Profile approval failed, rolling back state:",s),g(r=>{const t=r.find(i=>k(i)===a);return t?[...r,t]:r}),m(r=>r.filter(t=>k(t)!==a));const e=h(s,"approveProfile","Failed to approve profile");return l(e),{success:!1,error:e}}finally{f(!1)}},[u,c,P,h,y]),D=o.useCallback(async(a,n)=>{if(!R(a)){const e=A("reject profile","Invalid profile ID provided");return l(e),{success:!1,error:e}}if(!n||typeof n!="string"||n.trim().length<10){const e="Rejection reason must be at least 10 characters long.";return l(e),{success:!1,error:e}}if(y){const e="Another operation is in progress. Please wait.";return console.warn("🚫 rejectProfile: Operation blocked - another operation in progress"),{success:!1,error:e}}f(!0),l(null);const s=async()=>{const e=await w.rejectJobSeeker(a,n);if(e.success)return e;throw new Error(e.error||"Failed to reject profile")};try{g(r=>r.filter(t=>k(t)!==a));const e=await P(s);e.data&&v(r=>[...r,e.data]);try{await u("pending",c,!1)}catch{}return{success:!0,data:e.data,message:e.message||"Profile rejected successfully"}}catch(e){console.error("❌ Profile rejection failed, rolling back state:",e),g(t=>{const i=t.find(L=>k(L)===a);return i?[...t,i]:t}),v(t=>t.filter(i=>k(i)!==a));const r=h(e,"rejectProfile","Failed to reject profile");return l(r),{success:!1,error:r}}finally{f(!1)}},[u,c,P,h,y]),N=o.useCallback(async a=>{f(!0),l(null);try{const n=await Promise.all(a.map(r=>w.approveJobSeeker(r))),s=n.filter(r=>r.success),e=n.filter(r=>!r.success);if(e.length===0)return g(r=>r.filter(t=>!a.includes(t.id))),m(r=>[...r,...s.map(t=>t.data)]),await u("pending",c),{success:!0,message:`Successfully approved ${s.length} profiles`,count:s.length};{const r=`Failed to approve ${e.length} profiles`;return l(r),{success:!1,error:r,failed:e}}}catch(n){const s="An error occurred during bulk approval";return console.error("💥 Bulk approve error:",n),l(s),{success:!1,error:s}}finally{f(!1)}},[u,c]),q=o.useCallback(async(a,n)=>{f(!0),l(null);try{const s=await Promise.all(a.map(t=>w.rejectJobSeeker(t,n))),e=s.filter(t=>t.success),r=s.filter(t=>!t.success);if(r.length===0)return g(t=>t.filter(i=>!a.includes(i.id))),v(t=>[...t,...e.map(i=>i.data)]),await u("pending",c),{success:!0,message:`Successfully rejected ${e.length} profiles`,count:e.length};{const t=`Failed to reject ${r.length} profiles`;return l(t),{success:!1,error:t,failed:r}}}catch(s){const e="An error occurred during bulk rejection";return console.error("💥 Bulk reject error:",s),l(e),{success:!1,error:e}}finally{f(!1)}},[u,c]),W=o.useCallback(a=>{b(Math.max(1,Math.min(a,p.totalPages)))},[p.totalPages]),I=o.useCallback(()=>{c<p.totalPages&&b(c+1)},[c,p.totalPages]),K=o.useCallback(()=>{c>1&&b(c-1)},[c]);return o.useEffect(()=>{S&&u("pending",1)},[S,u]),o.useEffect(()=>{l(null)},[c]),o.useEffect(()=>()=>{d.current&&d.current.abort()},[]),{pendingProfiles:O,approvedProfiles:$,rejectedProfiles:x,loading:y,error:C,retryCount:E,currentPage:c,pagination:p,fetchProfilesByStatus:u,approveProfile:J,rejectProfile:D,bulkApprove:N,bulkReject:q,goToPage:W,nextPage:I,prevPage:K,setCurrentPage:b,hasNextPage:c<p.totalPages,hasPrevPage:c>1,totalItems:p.total,totalPages:p.totalPages,clearError:()=>l(null),hasError:!!C,isRetrying:E>0}};export{_ as u};
