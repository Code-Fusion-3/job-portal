import{c as $,r as n,j as e,a0 as I,ap as Q,s as A,S as V,a3 as W,am as X,aj as Y,ak as C}from"./vendor-react-DCVpIq7q.js";import{L as Z,B as l,C as g}from"./index-DRNx2Vuk.js";import{M as v}from"./Modal-iVsMiAJb.js";import{a as ee}from"./useCategories-B6SFosiw.js";import"./vendor-common-BZD0eUgH.js";import"./vendor-motion-BnaYlrdq.js";import"./vendor-gsap-lnFyu4_T.js";import"./categoryService-BZJziUCR.js";const de=()=>{const{t:se}=$(),{categories:j,loading:i,error:_,createCategory:M,updateCategory:J,deleteCategory:L,fetchCategories:k}=ee({includeAdmin:!0}),[P,b]=n.useState(!1),[T,w]=n.useState(!1),[F,N]=n.useState(!1),[u,c]=n.useState(null),[p,K]=n.useState(""),[o,d]=n.useState(!1),[m,a]=n.useState(""),[t,x]=n.useState({name_en:"",name_rw:""}),f=j.filter(s=>s.name_en.toLowerCase().includes(p.toLowerCase())||s.name_rw.toLowerCase().includes(p.toLowerCase())),y=s=>{const{name:r,value:H}=s.target;x(O=>({...O,[r]:H}))},q=async s=>{if(s.preventDefault(),!t.name_en.trim()||!t.name_rw.trim()){a("Please fill in both English and Kinyarwanda names");return}if(t.name_en.trim().length<2){a("English name must be at least 2 characters long");return}if(t.name_rw.trim().length<2){a("Kinyarwanda name must be at least 2 characters long");return}d(!0),a("");try{const r=await M({name_en:t.name_en.trim(),name_rw:t.name_rw.trim()});r.success?(x({name_en:"",name_rw:""}),b(!1),C.success("Job category created successfully!")):a(r.error||"Failed to create category")}catch(r){console.error("Error creating category:",r),a("Network error. Please try again.")}finally{d(!1)}},z=async s=>{if(s.preventDefault(),!t.name_en.trim()||!t.name_rw.trim()){a("Please fill in both English and Kinyarwanda names");return}if(t.name_en.trim().length<2){a("English name must be at least 2 characters long");return}if(t.name_rw.trim().length<2){a("Kinyarwanda name must be at least 2 characters long");return}d(!0),a("");try{const r=await J(u.id,{name_en:t.name_en.trim(),name_rw:t.name_rw.trim()});r.success?(x({name_en:"",name_rw:""}),c(null),w(!1),C.success("Job category updated successfully!")):a(r.error||"Failed to update category")}catch(r){console.error("Error updating category:",r),a("Network error. Please try again.")}finally{d(!1)}},R=async()=>{d(!0),a("");try{const s=await L(u.id);s.success?(c(null),N(!1),C.success("Job category deleted successfully!")):(a(s.error||"Failed to delete category"),s.profilesCount&&a(`Cannot delete category. It is being used by ${s.profilesCount} job seekers.`))}catch(s){console.error("Error deleting category:",s),a("Network error. Please try again.")}finally{d(!1)}},U=s=>{c(s),x({name_en:s.name_en,name_rw:s.name_rw}),a(""),w(!0)},B=s=>{c(s),a(""),N(!0)},S=()=>{b(!1),x({name_en:"",name_rw:""}),a("")},E=()=>{w(!1),c(null),x({name_en:"",name_rw:""}),a("")},D=()=>{N(!1),c(null),a("")},G=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),h={total:j.length,totalJobSeekers:j.reduce((s,r)=>s+(r._count?.profiles||0),0)};return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Z,{size:"lg",text:"Loading categories..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Job Categories"}),e.jsx("p",{className:"text-gray-600",children:"Manage job categories for the platform"}),e.jsx("p",{className:"text-sm text-gray-500",children:"All categories are displayed for easy management"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(l,{onClick:k,variant:"outline",disabled:i,className:"flex items-center gap-2",children:[e.jsx(I,{className:`w-4 h-4 ${i?"animate-spin":""}`}),i?"Refreshing...":"Refresh"]}),e.jsxs(l,{onClick:()=>b(!0),className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Category"]})]})]}),_&&e.jsx(g,{className:"p-4 border-red-200 bg-red-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 bg-red-400 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-red-800 text-xs",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Error loading categories"}),e.jsx("p",{className:"text-red-600 text-sm",children:_})]}),e.jsx(l,{onClick:k,variant:"outline",size:"sm",className:"ml-auto",children:"Retry"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Categories"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.total}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Showing all ",h.total," categories"]})]}),e.jsx(A,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Job Seekers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.totalJobSeekers})]}),e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 bg-purple-600 rounded-full"})})]})})]}),e.jsx(g,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search categories...",value:p,onChange:s=>K(s.target.value),className:"w-full pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsx(g,{className:"overflow-hidden",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"px-6 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700",children:["Categories (",f.length," of ",h.total,")"]}),e.jsx("span",{className:"text-xs text-gray-500",children:f.length===h.total?"Showing all categories":`Filtered from ${h.total} total`})]})}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Job Seekers"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name_en}),e.jsx("div",{className:"text-sm text-gray-500",children:s.name_rw})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[s._count?.profiles||0," job seekers"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:G(s.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>U(s),className:"min-h-[32px] px-2",children:e.jsx(W,{className:"w-3 h-3"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>B(s),className:"min-h-[32px] px-2 text-red-600 hover:text-red-700",children:e.jsx(X,{className:"w-3 h-3"})})]})})]},s.id))})]}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:i?"Loading categories...":"No categories found"}),e.jsx("p",{className:"text-gray-600",children:i?"Please wait while we fetch the categories.":p?"Try adjusting your search criteria.":"Get started by creating your first job category."})]})]})}),e.jsx(v,{isOpen:P,onClose:S,title:"Add New Job Category",children:e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name (English) *"}),e.jsx("input",{type:"text",name:"name_en",value:t.name_en,onChange:y,placeholder:"e.g., Graphic Design",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name (Kinyarwanda) *"}),e.jsx("input",{type:"text",name:"name_rw",value:t.name_rw,onChange:y,placeholder:"e.g., Ubwubatsi bw'Amashusho",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:S,children:"Cancel"}),e.jsx(l,{type:"submit",disabled:o,children:o?"Creating...":"Create Category"})]}),m&&e.jsx("p",{className:"text-red-500 text-sm",children:m})]})}),e.jsx(v,{isOpen:T,onClose:E,title:"Edit Job Category",children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name (English) *"}),e.jsx("input",{type:"text",name:"name_en",value:t.name_en,onChange:y,placeholder:"e.g., Graphic Design",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name (Kinyarwanda) *"}),e.jsx("input",{type:"text",name:"name_rw",value:t.name_rw,onChange:y,placeholder:"e.g., Ubwubatsi bw'Amashusho",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:E,children:"Cancel"}),e.jsx(l,{type:"submit",disabled:o,children:o?"Updating...":"Update Category"})]}),m&&e.jsx("p",{className:"text-red-500 text-sm",children:m})]})}),e.jsx(v,{isOpen:F,onClose:D,title:"Delete Job Category",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:['Are you sure you want to delete the category "',u?.name_en,'"? This action cannot be undone.']}),u?._count?.profiles>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["⚠️ This category has ",u._count.profiles," job seekers. Deleting it may affect their profiles."]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(l,{variant:"outline",onClick:D,children:"Cancel"}),e.jsx(l,{variant:"danger",onClick:R,disabled:o,children:o?"Deleting...":"Delete Category"})]}),m&&e.jsx("p",{className:"text-red-500 text-sm",children:m})]})}),e.jsx(Y,{position:"top-right"})]})};export{de as default};
