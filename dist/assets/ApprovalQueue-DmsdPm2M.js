import{aR as re,j as e,aM as le,b8 as T,b6 as ie,bQ as ne,aY as $,r as l,ae as E,af as M,bk as O}from"./vendor-react-BGn7VswH.js";import{C as j,B as o,u as ce}from"./index-B4d9vEsx.js";import{u as oe}from"./useApprovalManagement-BPnmGnf0.js";import{S as _}from"./StatusBadge-oETaPpAp.js";import{R as de}from"./RejectionReasonModal-Dpu-z120.js";import{L as q}from"./vendor-router-BywwqvzY.js";import{m as x}from"./vendor-motion-DwrKfzy9.js";import"./vendor-gsap-B4nt0ofr.js";import"./Modal-BkQQC9fj.js";class me extends re.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null,retryCount:0}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,r){console.error("ApprovalErrorBoundary caught an error:",t,r),this.setState({error:t,errorInfo:r,hasError:!0}),this.props.onError&&this.props.onError(t,r)}handleRetry=()=>{this.setState(t=>({hasError:!1,error:null,errorInfo:null,retryCount:t.retryCount+1}))};render(){if(this.state.hasError){const{error:t,errorInfo:r,retryCount:i}=this.state,{fallback:m,showDetails:z=!1}=this.props;return m?e.jsx(m,{error:t,errorInfo:r,retry:this.handleRetry,retryCount:i}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs(j,{className:"max-w-2xl w-full p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(le,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"An error occurred in the approval system. This might be a temporary issue."}),i>0&&e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Retry attempts: ",i]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(o,{onClick:this.handleRetry,variant:"primary",className:"flex items-center justify-center gap-2",disabled:i>=3,children:[e.jsx(T,{className:"w-4 h-4"}),i>=3?"Max retries reached":"Try Again"]}),e.jsxs(o,{as:q,to:"/",variant:"outline",className:"flex items-center justify-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Go to Homepage"]}),e.jsxs(o,{as:q,to:"/contact",variant:"outline",className:"flex items-center justify-center gap-2 text-blue-600 border-blue-300 hover:bg-blue-50",children:[e.jsx(ne,{className:"w-4 h-4"}),"Contact Support"]})]}),z&&t&&e.jsxs("details",{className:"mt-8 text-left",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"Technical Details"}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-100 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Error:"}),e.jsx("p",{className:"text-sm text-gray-700 mb-4 font-mono",children:t.toString()}),r&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Stack Trace:"}),e.jsx("pre",{className:"text-xs text-gray-600 overflow-auto bg-white p-2 rounded border",children:r.componentStack})]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500",children:"If this problem persists, please contact our support team with the error details above."})})]})})}return this.props.children}}const xe=({count:d=3})=>e.jsx("div",{className:"space-y-4",children:Array.from({length:d}).map((t,r)=>e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.1},className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded animate-pulse w-32"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-48"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-20"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-24"})]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-20"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-20"})]})]})},r))}),he=()=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Array.from({length:3}).map((d,t)=>e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-24"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-16"})]}),e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg animate-pulse"})]})},t))}),pe=({retryCount:d,maxRetries:t=3,onRetry:r,className:i=""})=>{const m=d<t;return e.jsxs(x.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:`flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-lg ${i}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx($,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800",children:m?"Operation failed":"Max retries reached"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["Retry attempt: ",d," of ",t]})]})]}),m&&r&&e.jsx("button",{onClick:r,className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm font-medium",children:"Retry"})]})},Re=()=>{const{user:d}=ce(),[t,r]=l.useState(!1),[i,m]=l.useState(null),[z,ue]=l.useState(""),[H,B]=l.useState(""),[Y,g]=l.useState(""),[f,F]=l.useState(!1),[N,y]=l.useState(!1),{pendingProfiles:h,approvedProfiles:v,rejectedProfiles:b,loading:c,error:D,retryCount:w,approveProfile:L,rejectProfile:Q,fetchProfilesByStatus:U,currentPage:G,pagination:C,nextPage:X,prevPage:J,hasNextPage:K,hasPrevPage:V,clearError:u,hasError:W,isRetrying:Z}=oe({autoFetch:!0,itemsPerPage:20}),R=l.useMemo(()=>({approve:L,reject:Q}),[L,Q]),P=l.useMemo(()=>({pending:h.length,approved:v.length,rejected:b.length}),[h.length,v.length,b.length]);l.useEffect(()=>{if(f){const s=setTimeout(()=>{F(!1),B("")},3e3);return()=>clearTimeout(s)}},[f]),l.useEffect(()=>{if(N){const s=setTimeout(()=>{y(!1),g("")},5e3);return()=>clearTimeout(s)}},[N]);const I=l.useCallback(async(s,a,p=null)=>{try{let n;if(a==="approved")n=await R.approve(s);else if(a==="rejected"){if(!p){g("Rejection reason is required"),y(!0);return}n=await R.reject(s,p)}n&&n.success?(B(n.message||`Profile ${a} successfully`),F(!0),u()):n&&(g(n.error||`Failed to ${a} profile`),y(!0))}catch(n){g(`Failed to ${a} profile`),y(!0),console.error("Approval change error:",n)}},[R,u]),ee=s=>{m(s),r(!0)},se=async s=>{i&&(await I(i.id,"rejected",s),r(!1),m(null))},S=l.useCallback(s=>{const a=s.profile?.firstName||s.firstName||"Unknown",p=s.profile?.lastName||s.lastName||"";return`${a} ${p}`.trim()},[]),k=l.useCallback(s=>{const a=s.profile?.photo||s.photo;return a?/^https?:\/\//i.test(a)?a:`http://localhost:3000/${a.replace(/^\//,"")}`:null},[]),te=l.useCallback(s=>{const a=s.profile?.firstName||s.firstName||"",p=s.profile?.lastName||s.lastName||"",n=a?a.charAt(0).toUpperCase():"",ae=p?p.charAt(0).toUpperCase():"";return`${n}${ae}`||"U"},[]),A=l.useCallback(async()=>{u(),await U("pending",1)},[u,U]);return!d||d.role!=="admin"?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."})]})}):e.jsx(me,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Approval Queue"}),e.jsx("p",{className:"text-gray-600",children:"Review and approve pending job seeker profiles"}),Z&&e.jsxs("p",{className:"text-sm text-yellow-600 mt-1",children:["Retrying operation... (Attempt ",w,")"]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(o,{onClick:A,variant:"outline",disabled:c,className:"flex items-center gap-2",children:[e.jsx(T,{className:`w-4 h-4 ${c?"animate-spin":""}`}),"Refresh"]})})]}),f&&e.jsx(x.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-green-700",children:H})]})}),N&&e.jsx(x.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-red-700",children:Y})]})}),c&&h.length===0&&v.length===0&&b.length===0?e.jsx(he,{}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Review"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:P.pending})]}),e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-yellow-600"})})]})})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approved Today"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:P.approved})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(M,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rejected Today"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:P.rejected})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(O,{className:"w-6 h-6 text-red-600"})})]})})})]}),e.jsx(j,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Pending Profiles (",h.length,")"]}),e.jsx(_,{status:"pending",size:"lg"})]}),W&&w>0&&e.jsx(pe,{retryCount:w,onRetry:A,className:"mb-6"}),c&&h.length===0?e.jsx(xe,{count:5}):D?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"w-5 h-5 text-red-500"}),e.jsxs("span",{className:"text-red-700",children:["Error: ",D]})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs(o,{onClick:A,variant:"outline",size:"sm",disabled:c,children:[e.jsx(T,{className:`w-4 h-4 mr-2 ${c?"animate-spin":""}`}),"Retry"]}),e.jsx(o,{onClick:u,variant:"ghost",size:"sm",children:"Dismiss"})]})]}):h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No pending profiles"}),e.jsx("p",{className:"text-gray-600",children:"All job seeker profiles have been reviewed."})]}):e.jsx("div",{className:"space-y-4",children:h.map(s=>e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center",children:[k(s)?e.jsx("img",{src:k(s),alt:S(s),className:"w-full h-full object-cover",onError:a=>{a.currentTarget.style.display="none",a.currentTarget.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-300 text-lg font-semibold text-white",style:{display:k(s)?"none":"flex"},children:te(s)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:S(s)}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email||"No email"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:s.profile?.location||"No location"}),s.profile?.experienceLevel&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:s.profile.experienceLevel.replace("_"," ")})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{status:"pending",size:"sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{onClick:()=>I(s.id,"approved"),variant:"primary",size:"sm",disabled:c,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Approve"]}),e.jsxs(o,{onClick:()=>ee(s),variant:"danger",size:"sm",disabled:c,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Reject"]})]})]})]})},s.id))}),C.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing page ",G," of ",C.totalPages," (",C.total," total profiles)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{onClick:J,disabled:!V||c,variant:"outline",size:"sm",children:"Previous"}),e.jsx(o,{onClick:X,disabled:!K||c,variant:"outline",size:"sm",children:"Next"})]})]})]})}),e.jsx(de,{isOpen:t,onClose:()=>{r(!1),m(null)},onSubmit:se,profileName:i?S(i):"this profile"})]})})};export{Re as default};
